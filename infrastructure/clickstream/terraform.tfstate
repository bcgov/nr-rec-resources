{
  "version": 4,
  "terraform_version": "1.5.7",
  "serial": 31,
  "lineage": "d6b4914f-c5ed-69a5-4855-2d46239c8ed4",
  "outputs": {},
  "resources": [
    {
      "mode": "managed",
      "type": "aws_cloudformation_stack",
      "name": "clickstream",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "capabilities": ["CAPABILITY_NAMED_IAM"],
            "disable_rollback": false,
            "iam_role_arn": "",
            "id": "arn:aws:cloudformation:ca-central-1:881490129697:stack/clickstream-stack/a6d9edf0-1b02-11f0-aa00-066a3eabdcc5",
            "name": "clickstream-stack",
            "notification_arns": null,
            "on_failure": null,
            "outputs": {
              "ClickStreamApiEndpoint5F7E3E22": "https://844ws30h7k.execute-api.ca-central-1.amazonaws.com/api/",
              "ControlPlaneBucket": "clickstream-stack-clickstreamsolutiondatabucket200-hsbdhjbsy1df",
              "ControlPlaneURL": "https://d1tscjgbucnx3d.cloudfront.net"
            },
            "parameters": {
              "Email": "marcel@button.is"
            },
            "policy_body": null,
            "policy_url": null,
            "tags": null,
            "tags_all": {},
            "template_body": "{\"Conditions\":{\"AWSCNCondition\":{\"Fn::Equals\":[\"aws-cn\",{\"Ref\":\"AWS::Partition\"}]},\"CDKMetadataAvailable\":{\"Fn::Or\":[{\"Fn::Or\":[{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"af-south-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"ap-east-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"ap-northeast-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"ap-northeast-2\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"ap-south-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"ap-southeast-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"ap-southeast-2\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"ca-central-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"cn-north-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"cn-northwest-1\"]}]},{\"Fn::Or\":[{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"eu-central-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"eu-north-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"eu-south-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"eu-west-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"eu-west-2\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"eu-west-3\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"il-central-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"me-central-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"me-south-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"sa-east-1\"]}]},{\"Fn::Or\":[{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"us-east-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"us-east-2\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"us-west-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"us-west-2\"]}]}]},\"IsEmptyRolePrefixCondition\":{\"Fn::Equals\":[{\"Ref\":\"IamRolePrefix\"},\"\"]},\"cloudfrontcontrolplanenotOpsInRegionFA8E79C7\":{\"Fn::Or\":[{\"Fn::Or\":[{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"us-east-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"us-east-2\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"us-west-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"us-west-2\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"ap-south-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"ap-northeast-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"ap-northeast-2\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"ap-northeast-3\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"ap-southeast-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"ap-southeast-2\"]}]},{\"Fn::Or\":[{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"ca-central-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"eu-central-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"eu-west-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"eu-west-2\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"eu-west-3\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"eu-north-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"sa-east-1\"]}]}]},\"isEmptyPermissionBoundary\":{\"Fn::Equals\":[{\"Ref\":\"IamRoleBoundaryArn\"},\"\"]},\"isEmptyRolePrefix\":{\"Fn::Equals\":[{\"Ref\":\"IamRolePrefix\"},\"\"]}},\"Description\":\"(SO0219) Clickstream Analytics on AWS (Version v1.1.11)(Build 202503111525)- Control Plane\",\"Mappings\":{\"ServiceprincipalMap\":{\"af-south-1\":{\"states\":\"states.af-south-1.amazonaws.com\"},\"ap-east-1\":{\"states\":\"states.ap-east-1.amazonaws.com\"},\"ap-northeast-1\":{\"states\":\"states.ap-northeast-1.amazonaws.com\"},\"ap-northeast-2\":{\"states\":\"states.ap-northeast-2.amazonaws.com\"},\"ap-northeast-3\":{\"states\":\"states.ap-northeast-3.amazonaws.com\"},\"ap-south-1\":{\"states\":\"states.ap-south-1.amazonaws.com\"},\"ap-south-2\":{\"states\":\"states.ap-south-2.amazonaws.com\"},\"ap-southeast-1\":{\"states\":\"states.ap-southeast-1.amazonaws.com\"},\"ap-southeast-2\":{\"states\":\"states.ap-southeast-2.amazonaws.com\"},\"ap-southeast-3\":{\"states\":\"states.ap-southeast-3.amazonaws.com\"},\"ap-southeast-4\":{\"states\":\"states.ap-southeast-4.amazonaws.com\"},\"ca-central-1\":{\"states\":\"states.ca-central-1.amazonaws.com\"},\"cn-north-1\":{\"states\":\"states.cn-north-1.amazonaws.com\"},\"cn-northwest-1\":{\"states\":\"states.cn-northwest-1.amazonaws.com\"},\"eu-central-1\":{\"states\":\"states.eu-central-1.amazonaws.com\"},\"eu-central-2\":{\"states\":\"states.eu-central-2.amazonaws.com\"},\"eu-north-1\":{\"states\":\"states.eu-north-1.amazonaws.com\"},\"eu-south-1\":{\"states\":\"states.eu-south-1.amazonaws.com\"},\"eu-south-2\":{\"states\":\"states.eu-south-2.amazonaws.com\"},\"eu-west-1\":{\"states\":\"states.eu-west-1.amazonaws.com\"},\"eu-west-2\":{\"states\":\"states.eu-west-2.amazonaws.com\"},\"eu-west-3\":{\"states\":\"states.eu-west-3.amazonaws.com\"},\"il-central-1\":{\"states\":\"states.il-central-1.amazonaws.com\"},\"me-central-1\":{\"states\":\"states.me-central-1.amazonaws.com\"},\"me-south-1\":{\"states\":\"states.me-south-1.amazonaws.com\"},\"sa-east-1\":{\"states\":\"states.sa-east-1.amazonaws.com\"},\"us-east-1\":{\"states\":\"states.us-east-1.amazonaws.com\"},\"us-east-2\":{\"states\":\"states.us-east-2.amazonaws.com\"},\"us-gov-east-1\":{\"states\":\"states.us-gov-east-1.amazonaws.com\"},\"us-gov-west-1\":{\"states\":\"states.us-gov-west-1.amazonaws.com\"},\"us-iso-east-1\":{\"states\":\"states.amazonaws.com\"},\"us-iso-west-1\":{\"states\":\"states.amazonaws.com\"},\"us-isob-east-1\":{\"states\":\"states.amazonaws.com\"},\"us-west-1\":{\"states\":\"states.us-west-1.amazonaws.com\"},\"us-west-2\":{\"states\":\"states.us-west-2.amazonaws.com\"}}},\"Metadata\":{\"AWS::CloudFormation::Interface\":{\"ParameterGroups\":[{\"Label\":{\"default\":\"Authentication Information\"},\"Parameters\":[\"Email\"]},{\"Label\":{\"default\":\"IAM Role Information\"},\"Parameters\":[\"IamRolePrefix\",\"IamRoleBoundaryArn\"]}],\"ParameterLabels\":{\"Email\":{\"default\":\"Admin User Email\"},\"IamRoleBoundaryArn\":{\"default\":\"IAM Role Boundary ARN(Optional)\"},\"IamRolePrefix\":{\"default\":\"IAM Role Prefix(Optional)\"}}},\"cdk_nag\":{\"rules_to_suppress\":[{\"id\":\"AwsSolutions-IAM4\",\"reason\":\"LogRetention lambda role which are created by CDK uses AWSLambdaBasicExecutionRole\"},{\"id\":\"AwsSolutions-L1\",\"reason\":\"The lambda is created by CDK, CustomResource framework-onEvent, the runtime version will be upgraded by CDK\"},{\"id\":\"AwsSolutions-SQS3\",\"reason\":\"The SQS is a dead-letter queue (DLQ), and does not need a DLQ enabled\"},{\"id\":\"AwsSolutions-IAM4\",\"reason\":\"Cause by CDK BucketDeployment construct (aws-cdk-lib/aws-s3-deployment)\"},{\"id\":\"AwsSolutions-IAM5\",\"reason\":\"Cause by CDK BucketDeployment construct (aws-cdk-lib/aws-s3-deployment)\"},{\"id\":\"AwsSolutions-APIG2\",\"reason\":\"The REST API input validation in Lambda(Express) code, the front ApiGateway does not need repeated validation.\"},{\"id\":\"AwsSolutions-COG4\",\"reason\":\"The REST API validate input via OIDC authorizer, there is no need to use Cognito user pool authorizer.\"},{\"id\":\"AwsSolutions-CFR7\",\"reason\":\"The Cloudfront distribution uses an origin access control for the S3 origin.\"},{\"id\":\"AwsSolutions-CFR4\",\"reason\":\"Cause by using default default CloudFront viewer certificate\"},{\"id\":\"AwsSolutions-L1\",\"reason\":\"Managed by CDK Cognito module for get service token\"}]}},\"Outputs\":{\"ClickStreamApiEndpoint5F7E3E22\":{\"Value\":{\"Fn::Join\":[\"\",[\"https://\",{\"Ref\":\"ClickStreamApi748490D9\"},\".execute-api.\",{\"Ref\":\"AWS::Region\"},\".\",{\"Ref\":\"AWS::URLSuffix\"},\"/\",{\"Ref\":\"ClickStreamApiDeploymentStageapi40499B1B\"},\"/\"]]}},\"ControlPlaneBucket\":{\"Description\":\"Bucket to store solution console data and services logs\",\"Value\":{\"Ref\":\"ClickstreamSolutionDataBucket200465FE\"}},\"ControlPlaneURL\":{\"Description\":\"The url of clickstream console\",\"Value\":{\"Fn::Join\":[\"\",[\"https://\",{\"Fn::GetAtt\":[\"cloudfrontcontrolplanePortalDistributionCAE911E8\",\"DomainName\"]}]]}}},\"Parameters\":{\"Email\":{\"AllowedPattern\":\"^^(?=.{0,320}$)\\\\w+([-+.]\\\\w+)*@\\\\w+([-.]\\\\w+)*\\\\.\\\\w+([-.]\\\\w+)*$\",\"ConstraintDescription\":\"Email address must match pattern ^(?=.{0,320}$)\\\\w+([-+.]\\\\w+)*@\\\\w+([-.]\\\\w+)*\\\\.\\\\w+([-.]\\\\w+)*\",\"Description\":\"Email address of admin user \",\"Type\":\"String\"},\"IamRoleBoundaryArn\":{\"Default\":\"\",\"Description\":\"Set permissions boundaries for the IAM Roles created in the solution.\",\"Type\":\"String\"},\"IamRolePrefix\":{\"AllowedPattern\":\"^([a-zA-Z][a-zA-Z0-9-_]{1,20})?$\",\"Default\":\"\",\"Description\":\"The prefix of the IAM Roles created in the solution.\",\"Type\":\"String\"}},\"Resources\":{\"AWS679f53fac002430cb0da5b7982bd22872D164C4C\":{\"DependsOn\":[\"AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2\"],\"Metadata\":{\"aws:asset:is-bundled\":false,\"aws:asset:path\":\"asset.97f30e67419a1676a2215492723e5add1aa491caf0cbe2dd878fc4fab0468cd4\",\"aws:asset:property\":\"Code\",\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/AWS679f53fac002430cb0da5b7982bd2287/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W89\",\"reason\":\"Lambda function is only used by AddAdminUserFunction for deployment as cloudformation custom resources or per product design, no need to be deployed in VPC\"},{\"id\":\"W92\",\"reason\":\"Lambda function is only used by AddAdminUserFunction for deployment as cloudformation custom resources or per product design, no need to set ReservedConcurrentExecutions\"}]}},\"Properties\":{\"Code\":{\"S3Bucket\":{\"Fn::Sub\":\"solutions-${AWS::Region}\"},\"S3Key\":\"clickstream-analytics-on-aws/v1.1.11/97f30e67419a1676a2215492723e5add1aa491caf0cbe2dd878fc4fab0468cd4.zip\"},\"Environment\":{\"Variables\":{\"USER_AGENT_STRING\":\"AWSSOLUTION/SO0219/v1.1.11-202503111525\"}},\"Handler\":\"index.handler\",\"Role\":{\"Fn::GetAtt\":[\"AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2\",\"Arn\"]},\"Runtime\":\"nodejs18.x\",\"Timeout\":60},\"Type\":\"AWS::Lambda::Function\"},\"AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/AWS679f53fac002430cb0da5b7982bd2287/ServiceRole/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W28\",\"reason\":\"Set the role name with prefix\"}]}},\"Properties\":{\"AssumeRolePolicyDocument\":{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"lambda.amazonaws.com\"}}],\"Version\":\"2012-10-17\"},\"ManagedPolicyArns\":[{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\"]]}],\"PermissionsBoundary\":{\"Fn::If\":[\"isEmptyPermissionBoundary\",{\"Ref\":\"AWS::NoValue\"},{\"Ref\":\"IamRoleBoundaryArn\"}]},\"RoleName\":{\"Fn::If\":[\"isEmptyRolePrefix\",{\"Ref\":\"AWS::NoValue\"},{\"Fn::Join\":[\"\",[{\"Ref\":\"IamRolePrefix\"},\"-82bd2287ServiceRole-\",{\"Ref\":\"AWS::Region\"},\"-\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]}]]}]}},\"Type\":\"AWS::IAM::Role\"},\"ApiGatewayOriginRequestPolicy339DF282\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ApiGatewayOriginRequestPolicy/Resource\"},\"Properties\":{\"OriginRequestPolicyConfig\":{\"Comment\":\"Policy to forward all parameters in viewer requests except for the Host header\",\"CookiesConfig\":{\"CookieBehavior\":\"all\"},\"HeadersConfig\":{\"HeaderBehavior\":\"allExcept\",\"Headers\":[\"host\"]},\"Name\":{\"Fn::Join\":[\"\",[\"ApiGatewayOriginRequestPolicy-\",{\"Ref\":\"AWS::Region\"},\"-\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]}]]},\"QueryStringsConfig\":{\"QueryStringBehavior\":\"all\"}}},\"Type\":\"AWS::CloudFront::OriginRequestPolicy\"},\"AuthorizerFunctionB4DBAA43\":{\"DependsOn\":[\"AuthorizerFunctionRoleDefaultPolicy21ECE726\",\"AuthorizerFunctionRoleDC80AC34\"],\"Metadata\":{\"aws:asset:is-bundled\":true,\"aws:asset:path\":\"asset.421e87ddd700a717cd77e0dfb9558bf56d65b94518dfba03ad5d5879575d3c62\",\"aws:asset:property\":\"Code\",\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/AuthorizerFunction/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W89\",\"reason\":\"Lambda function is only used by AuthorizerFunction for deployment as cloudformation custom resources or per product design, no need to be deployed in VPC\"},{\"id\":\"W92\",\"reason\":\"Lambda function is only used by AuthorizerFunction for deployment as cloudformation custom resources or per product design, no need to set ReservedConcurrentExecutions\"}]}},\"Properties\":{\"Architectures\":[\"arm64\"],\"Code\":{\"S3Bucket\":{\"Fn::Sub\":\"solutions-${AWS::Region}\"},\"S3Key\":\"clickstream-analytics-on-aws/v1.1.11/421e87ddd700a717cd77e0dfb9558bf56d65b94518dfba03ad5d5879575d3c62.zip\"},\"Environment\":{\"Variables\":{\"AWS_NODEJS_CONNECTION_REUSE_ENABLED\":\"1\",\"ISSUER\":{\"Fn::Join\":[\"\",[\"https://cognito-idp.\",{\"Ref\":\"AWS::Region\"},\".amazonaws.com/\",{\"Ref\":\"userPoolDC9497E0\"}]]},\"LOG_LEVEL\":\"WARN\",\"POWERTOOLS_LOGGER_LOG_EVENT\":\"true\",\"POWERTOOLS_LOGGER_SAMPLE_RATE\":\"1\",\"POWERTOOLS_SERVICE_NAME\":\"ClickStreamAnalyticsOnAWS\",\"USER_AGENT_STRING\":\"AWSSOLUTION/SO0219/v1.1.11-202503111525\"}},\"Handler\":\"index.handler\",\"LoggingConfig\":{\"Fn::If\":[\"AWSCNCondition\",{\"Ref\":\"AWS::NoValue\"},{\"ApplicationLogLevel\":\"WARN\",\"LogFormat\":\"JSON\",\"LogGroup\":{\"Ref\":\"AuthorizerFunctionlog76BEC188\"}}]},\"MemorySize\":512,\"Role\":{\"Fn::GetAtt\":[\"AuthorizerFunctionRoleDC80AC34\",\"Arn\"]},\"Runtime\":{\"Fn::If\":[\"AWSCNCondition\",\"nodejs18.x\",\"nodejs20.x\"]},\"Timeout\":15},\"Type\":\"AWS::Lambda::Function\"},\"AuthorizerFunctionRoleDC80AC34\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/AuthorizerFunctionRole/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W28\",\"reason\":\"Set the role name with prefix\"}]}},\"Properties\":{\"AssumeRolePolicyDocument\":{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"lambda.amazonaws.com\"}}],\"Version\":\"2012-10-17\"},\"PermissionsBoundary\":{\"Fn::If\":[\"isEmptyPermissionBoundary\",{\"Ref\":\"AWS::NoValue\"},{\"Ref\":\"IamRoleBoundaryArn\"}]},\"RoleName\":{\"Fn::If\":[\"isEmptyRolePrefix\",{\"Ref\":\"AWS::NoValue\"},{\"Fn::Join\":[\"\",[{\"Ref\":\"IamRolePrefix\"},\"-horizerFunctionRole-\",{\"Ref\":\"AWS::Region\"},\"-\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]}]]}]}},\"Type\":\"AWS::IAM::Role\"},\"AuthorizerFunctionRoleDefaultPolicy21ECE726\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/AuthorizerFunctionRole/DefaultPolicy/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W12\",\"reason\":\"The lambda service writes to undetermined logs stream by design\"}]}},\"Properties\":{\"PolicyDocument\":{\"Statement\":[{\"Action\":[\"logs:CreateLogStream\",\"logs:PutLogEvents\",\"logs:CreateLogGroup\"],\"Effect\":\"Allow\",\"Resource\":\"*\"}],\"Version\":\"2012-10-17\"},\"PolicyName\":\"AuthorizerFunctionRoleDefaultPolicy21ECE726\",\"Roles\":[{\"Ref\":\"AuthorizerFunctionRoleDC80AC34\"}]},\"Type\":\"AWS::IAM::Policy\"},\"AuthorizerFunctioncloudfronts3controlplanestackglobalJWTAuthorizer35A98B82PermissionsFC2234F3\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/AuthorizerFunction/cloudfronts3controlplanestackglobalJWTAuthorizer35A98B82:Permissions\"},\"Properties\":{\"Action\":\"lambda:InvokeFunction\",\"FunctionName\":{\"Fn::GetAtt\":[\"AuthorizerFunctionB4DBAA43\",\"Arn\"]},\"Principal\":\"apigateway.amazonaws.com\",\"SourceArn\":{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":execute-api:\",{\"Ref\":\"AWS::Region\"},\":\",{\"Ref\":\"AWS::AccountId\"},\":\",{\"Ref\":\"ClickStreamApi748490D9\"},\"/authorizers/\",{\"Ref\":\"JWTAuthorizerE8D8D90E\"}]]}},\"Type\":\"AWS::Lambda::Permission\"},\"AuthorizerFunctionlog76BEC188\":{\"DeletionPolicy\":\"Delete\",\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/AuthorizerFunction-log/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W84\",\"reason\":\"Log group data is always encrypted in CloudWatch Logs. By default, CloudWatch Logs uses server-side encryption for the log data at rest.\"}]}},\"Properties\":{\"LogGroupClass\":\"STANDARD\"},\"Type\":\"AWS::Logs::LogGroup\",\"UpdateReplacePolicy\":\"Delete\"},\"CDKMetadata\":{\"Condition\":\"CDKMetadataAvailable\",\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/CDKMetadata/Default\"},\"Properties\":{\"Analytics\":\"v2:deflate64:H4sIAAAAAAAA/3VUXXebMAz9LX13vX7sD6S03XpOsjHSbo85ilGIG7CpJSfNOPz3HRsSSJe+oCvZkq2ra27k9dcreXUBO7pU+eay1EvZzBnURsCOFg3dyubOqw2ySFamR51JbanVfgj3fufcAWErVGl9vnLWsGwevVGsrQkJR5wh1dYQfkfI0dFQ8tOFn04X2kyUQqLEGna2FAmoNQ5bxu69JnZ66eNp49ynHA1r7hLCNR/DNT/bcaZMhm8eiT/e7CTcCrpdNDnWpd1XaFh25NwfAwKIkElOgmlFCdUyB9kkKzOFPbrf6CicONemKJHtQNxZNpOVSdFVmmLSwxYNz613CmdQ19oUYcOZ6PioVmioZJPZEuMYgh1aPHSlbGE0W9m8ELrUhhGszBEfwL2tQJvxUh85uEmpAwejDf9Hgm1FaQuSzdQW35z1dVg/4qktMuQwqnD7jsGFsTm+kvwRzZEfqHUBjDvYy+bZbtBMPK+t03/RhZIjbxrLZEg8qXWvxwOcKGW9YTGaYlDI4M0ZisheBzKkSHd4EiJ19n1/iPSFOzxDXts8hHr0QlBgWkLPYO+0It8bqGy+lM0zLLsxRdAKYqxXfbO0YKBNIC228mS2doNizlgf6KA5g+OHd1S+4+4kXTYpEIk/oFkka6tVSAbGGai1Nof2Bn8GdSswiItkk/lePj5e641k88ujj7EOxO8grJHbtiLxxLY6y1J4rdbkOs6zH3YZ9LuAHalSy8mOklJHSYv4qsIQovZPiqbObnWOLg5lXD0FBxVyp4jYh4qJC9dvCsz0ySIcdlK2jT8Cz7WPouhfWCuCHuUrfdne3MjrW3l18UpaXzpvWFcos87+A5tr0pSMBQAA\"},\"Type\":\"AWS::CDK::Metadata\"},\"ClickStreamApi748490D9\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/ClickStreamApi/Resource\"},\"Properties\":{\"EndpointConfiguration\":{\"Types\":[\"REGIONAL\"]},\"Name\":\"ClickStreamApi\"},\"Type\":\"AWS::ApiGateway::RestApi\"},\"ClickStreamApiANY82946512\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/ClickStreamApi/Default/ANY/Resource\"},\"Properties\":{\"AuthorizationType\":\"CUSTOM\",\"AuthorizerId\":{\"Ref\":\"JWTAuthorizerE8D8D90E\"},\"HttpMethod\":\"ANY\",\"Integration\":{\"IntegrationHttpMethod\":\"POST\",\"Type\":\"AWS_PROXY\",\"Uri\":{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":apigateway:\",{\"Ref\":\"AWS::Region\"},\":lambda:path/2015-03-31/functions/\",{\"Fn::GetAtt\":[\"ClickStreamApiApiFunction684A4D61\",\"Arn\"]},\"/invocations\"]]}},\"ResourceId\":{\"Fn::GetAtt\":[\"ClickStreamApi748490D9\",\"RootResourceId\"]},\"RestApiId\":{\"Ref\":\"ClickStreamApi748490D9\"}},\"Type\":\"AWS::ApiGateway::Method\"},\"ClickStreamApiANYApiPermissionTestcloudfronts3controlplanestackglobalClickStreamApiFB563409ANY453C9088\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/ClickStreamApi/Default/ANY/ApiPermission.Test.cloudfronts3controlplanestackglobalClickStreamApiFB563409.ANY..\"},\"Properties\":{\"Action\":\"lambda:InvokeFunction\",\"FunctionName\":{\"Fn::GetAtt\":[\"ClickStreamApiApiFunction684A4D61\",\"Arn\"]},\"Principal\":\"apigateway.amazonaws.com\",\"SourceArn\":{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":execute-api:\",{\"Ref\":\"AWS::Region\"},\":\",{\"Ref\":\"AWS::AccountId\"},\":\",{\"Ref\":\"ClickStreamApi748490D9\"},\"/test-invoke-stage/*/\"]]}},\"Type\":\"AWS::Lambda::Permission\"},\"ClickStreamApiANYApiPermissioncloudfronts3controlplanestackglobalClickStreamApiFB563409ANY5A5D2F49\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/ClickStreamApi/Default/ANY/ApiPermission.cloudfronts3controlplanestackglobalClickStreamApiFB563409.ANY..\"},\"Properties\":{\"Action\":\"lambda:InvokeFunction\",\"FunctionName\":{\"Fn::GetAtt\":[\"ClickStreamApiApiFunction684A4D61\",\"Arn\"]},\"Principal\":\"apigateway.amazonaws.com\",\"SourceArn\":{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":execute-api:\",{\"Ref\":\"AWS::Region\"},\":\",{\"Ref\":\"AWS::AccountId\"},\":\",{\"Ref\":\"ClickStreamApi748490D9\"},\"/\",{\"Ref\":\"ClickStreamApiDeploymentStageapi40499B1B\"},\"/*/\"]]}},\"Type\":\"AWS::Lambda::Permission\"},\"ClickStreamApiAccount2E4BAA6C\":{\"DeletionPolicy\":\"Retain\",\"DependsOn\":[\"ClickStreamApi748490D9\"],\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/ClickStreamApi/Account\"},\"Properties\":{\"CloudWatchRoleArn\":{\"Fn::GetAtt\":[\"ClickStreamApiCloudWatchRole5F1F73C6\",\"Arn\"]}},\"Type\":\"AWS::ApiGateway::Account\",\"UpdateReplacePolicy\":\"Retain\"},\"ClickStreamApiAddAdminUserCustomResourceAddAdminUserAwsCustomResourceBD22F9F9\":{\"DeletionPolicy\":\"Delete\",\"DependsOn\":[\"ClickStreamApiAddAdminUserCustomResourceAddAdminUserAwsCustomResourceCustomResourcePolicyB7F90F13\"],\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/AddAdminUserCustomResource/AddAdminUserAwsCustomResource/Resource/Default\"},\"Properties\":{\"Create\":{\"Fn::Join\":[\"\",[\"{\\\"service\\\":\\\"DynamoDB\\\",\\\"action\\\":\\\"putItem\\\",\\\"physicalResourceId\\\":{\\\"id\\\":\\\"AddAdminUserCustomResource\\\"},\\\"parameters\\\":{\\\"TableName\\\":\\\"\",{\"Ref\":\"ClickStreamApiClickstreamMetadataEC136DD8\"},\"\\\",\\\"Item\\\":{\\\"id\\\":{\\\"S\\\":\\\"\",{\"Ref\":\"Email\"},\"\\\"},\\\"type\\\":{\\\"S\\\":\\\"USER\\\"},\\\"prefix\\\":{\\\"S\\\":\\\"USER\\\"},\\\"roles\\\":{\\\"L\\\":[{\\\"S\\\":\\\"Admin\\\"}]},\\\"createAt\\\":{\\\"N\\\":\\\"1741709135849\\\"},\\\"updateAt\\\":{\\\"N\\\":\\\"1741709135849\\\"},\\\"operator\\\":{\\\"S\\\":\\\"Clickstream\\\"},\\\"deleted\\\":{\\\"BOOL\\\":false}},\\\"ConditionExpression\\\":\\\"attribute_not_exists(id)\\\"},\\\"logApiResponseData\\\":true}\"]]},\"Delete\":{\"Fn::Join\":[\"\",[\"{\\\"service\\\":\\\"DynamoDB\\\",\\\"action\\\":\\\"deleteItem\\\",\\\"physicalResourceId\\\":{\\\"id\\\":\\\"AddAdminUserCustomResource\\\"},\\\"parameters\\\":{\\\"TableName\\\":\\\"\",{\"Ref\":\"ClickStreamApiClickstreamMetadataEC136DD8\"},\"\\\",\\\"Key\\\":{\\\"id\\\":{\\\"S\\\":\\\"\",{\"Ref\":\"Email\"},\"\\\"},\\\"type\\\":{\\\"S\\\":\\\"USER\\\"}},\\\"ConditionExpression\\\":\\\"attribute_exists(id)\\\"},\\\"logApiResponseData\\\":true}\"]]},\"InstallLatestAwsSdk\":false,\"ServiceToken\":{\"Fn::GetAtt\":[\"AWS679f53fac002430cb0da5b7982bd22872D164C4C\",\"Arn\"]},\"Update\":{\"Fn::Join\":[\"\",[\"{\\\"service\\\":\\\"DynamoDB\\\",\\\"action\\\":\\\"updateItem\\\",\\\"physicalResourceId\\\":{\\\"id\\\":\\\"AddAdminUserCustomResource\\\"},\\\"parameters\\\":{\\\"TableName\\\":\\\"\",{\"Ref\":\"ClickStreamApiClickstreamMetadataEC136DD8\"},\"\\\",\\\"Key\\\":{\\\"id\\\":{\\\"S\\\":\\\"\",{\"Ref\":\"Email\"},\"\\\"},\\\"type\\\":{\\\"S\\\":\\\"USER\\\"}},\\\"UpdateExpression\\\":\\\"SET #roles = :roles, #prefix = :prefix, #createAt = :createAt, #updateAt = :updateAt, #operator = :operator, #deleted = :deleted\\\",\\\"ExpressionAttributeNames\\\":{\\\"#roles\\\":\\\"roles\\\",\\\"#createAt\\\":\\\"createAt\\\",\\\"#updateAt\\\":\\\"updateAt\\\",\\\"#operator\\\":\\\"operator\\\",\\\"#deleted\\\":\\\"deleted\\\",\\\"#prefix\\\":\\\"prefix\\\"},\\\"ExpressionAttributeValues\\\":{\\\":prefix\\\":{\\\"S\\\":\\\"USER\\\"},\\\":roles\\\":{\\\"L\\\":[{\\\"S\\\":\\\"Admin\\\"}]},\\\":createAt\\\":{\\\"N\\\":\\\"1741709135849\\\"},\\\":updateAt\\\":{\\\"N\\\":\\\"1741709135849\\\"},\\\":operator\\\":{\\\"S\\\":\\\"Clickstream\\\"},\\\":deleted\\\":{\\\"BOOL\\\":false}}},\\\"logApiResponseData\\\":true}\"]]}},\"Type\":\"Custom::AWS\",\"UpdateReplacePolicy\":\"Delete\"},\"ClickStreamApiAddAdminUserCustomResourceAddAdminUserAwsCustomResourceCustomResourcePolicyB7F90F13\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/AddAdminUserCustomResource/AddAdminUserAwsCustomResource/CustomResourcePolicy/Resource\"},\"Properties\":{\"PolicyDocument\":{\"Statement\":[{\"Action\":[\"dynamodb:PutItem\",\"dynamodb:UpdateItem\",\"dynamodb:DeleteItem\"],\"Effect\":\"Allow\",\"Resource\":{\"Fn::GetAtt\":[\"ClickStreamApiClickstreamMetadataEC136DD8\",\"Arn\"]},\"Sid\":\"DynamoWriteAccess\"}],\"Version\":\"2012-10-17\"},\"PolicyName\":\"ClickStreamApiAddAdminUserCustomResourceAddAdminUserAwsCustomResourceCustomResourcePolicyB7F90F13\",\"Roles\":[{\"Ref\":\"AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2\"}]},\"Type\":\"AWS::IAM::Policy\"},\"ClickStreamApiAnalyticsMetadata4C5E5BA1\":{\"DeletionPolicy\":\"Delete\",\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/AnalyticsMetadata/Resource\"},\"Properties\":{\"AttributeDefinitions\":[{\"AttributeName\":\"id\",\"AttributeType\":\"S\"},{\"AttributeName\":\"month\",\"AttributeType\":\"S\"},{\"AttributeName\":\"prefix\",\"AttributeType\":\"S\"}],\"BillingMode\":\"PAY_PER_REQUEST\",\"GlobalSecondaryIndexes\":[{\"IndexName\":\"prefix-month-index\",\"KeySchema\":[{\"AttributeName\":\"prefix\",\"KeyType\":\"HASH\"},{\"AttributeName\":\"month\",\"KeyType\":\"RANGE\"}],\"Projection\":{\"ProjectionType\":\"ALL\"}}],\"KeySchema\":[{\"AttributeName\":\"id\",\"KeyType\":\"HASH\"},{\"AttributeName\":\"month\",\"KeyType\":\"RANGE\"}],\"PointInTimeRecoverySpecification\":{\"PointInTimeRecoveryEnabled\":true},\"SSESpecification\":{\"SSEEnabled\":true}},\"Type\":\"AWS::DynamoDB::Table\",\"UpdateReplacePolicy\":\"Delete\"},\"ClickStreamApiApiFunction684A4D61\":{\"DependsOn\":[\"ClickStreamApiApiFunctionRoleDefaultPolicy7987A2B3\",\"ClickStreamApiApiFunctionRole378A2758\"],\"Metadata\":{\"aws:asset:is-bundled\":false,\"aws:asset:path\":\"asset.16caf1dd6a4f5ec8875fc1e72a86072eca93416aa6b36fba2acbeae1236ccd0b\",\"aws:asset:property\":\"Code\",\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/ApiFunction/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W89\",\"reason\":\"Lambda function is only used by ApiFunction for deployment as cloudformation custom resources or per product design, no need to be deployed in VPC\"},{\"id\":\"W92\",\"reason\":\"Lambda function is only used by ApiFunction for deployment as cloudformation custom resources or per product design, no need to set ReservedConcurrentExecutions\"}]}},\"Properties\":{\"Architectures\":[\"arm64\"],\"Code\":{\"S3Bucket\":{\"Fn::Sub\":\"solutions-${AWS::Region}\"},\"S3Key\":\"clickstream-analytics-on-aws/v1.1.11/16caf1dd6a4f5ec8875fc1e72a86072eca93416aa6b36fba2acbeae1236ccd0b.zip\"},\"Description\":\"Lambda function for api of solution Clickstream Analytics on AWS\",\"Environment\":{\"Variables\":{\"ANALYTICS_METADATA_TABLE_NAME\":{\"Ref\":\"ClickStreamApiAnalyticsMetadata4C5E5BA1\"},\"API_FUNCTION_LAMBDA_ROLE\":{\"Fn::GetAtt\":[\"ClickStreamApiApiFunctionRole378A2758\",\"Arn\"]},\"AWS_ACCOUNT_ID\":{\"Ref\":\"AWS::AccountId\"},\"AWS_LAMBDA_EXEC_WRAPPER\":\"/opt/bootstrap\",\"AWS_PARTITION\":{\"Ref\":\"AWS::Partition\"},\"AWS_URL_SUFFIX\":{\"Ref\":\"AWS::URLSuffix\"},\"CLICK_STREAM_TABLE_NAME\":{\"Ref\":\"ClickStreamApiClickstreamMetadataEC136DD8\"},\"DICTIONARY_TABLE_NAME\":{\"Ref\":\"ClickStreamApiClickstreamDictionaryFDA4AD32\"},\"FULL_SOLUTION_VERSION\":\"v1.1.11-202503111525\",\"HEALTH_CHECK_PATH\":\"/\",\"IAM_ROLE_BOUNDARY_ARN\":{\"Ref\":\"IamRoleBoundaryArn\"},\"IAM_ROLE_PREFIX\":{\"Ref\":\"IamRolePrefix\"},\"ISSUER\":\"\",\"LISTEN_STACK_QUEUE_ARN\":{\"Fn::GetAtt\":[\"ClickStreamApiBackendEventBusListenStackStatusQueueA9825F84\",\"Arn\"]},\"LOG_LEVEL\":\"WARN\",\"POWERTOOLS_LOGGER_LOG_EVENT\":\"true\",\"POWERTOOLS_LOGGER_SAMPLE_RATE\":\"1\",\"POWERTOOLS_SERVICE_NAME\":\"ClickStreamAnalyticsOnAWS\",\"PREFIX_MONTH_GSI_NAME\":\"prefix-month-index\",\"PREFIX_TIME_GSI_NAME\":\"prefix-time-index\",\"QUICKSIGHT_EMBED_ROLE_ARN\":{\"Fn::GetAtt\":[\"ClickStreamApiQuickSightEmbedRole56794DF9\",\"Arn\"]},\"STACK_ACTION_STATE_MACHINE\":{\"Ref\":\"ClickStreamApiStackActionStateMachine21A0158C\"},\"STACK_ID\":{\"Ref\":\"AWS::StackId\"},\"STACK_WORKFLOW_S3_BUCKET\":{\"Ref\":\"ClickstreamSolutionDataBucket200465FE\"},\"STACK_WORKFLOW_STATE_MACHINE\":{\"Ref\":\"ClickStreamApiStackWorkflowStateMachineC5F60F13\"},\"STS_UPLOAD_ROLE_ARN\":{\"Fn::GetAtt\":[\"ClickStreamApiUploadRole7BE99918\",\"Arn\"]},\"TEMPLATE_FILE\":\"cloudfront-s3-control-plane-stack-global.template.json\",\"USER_AGENT_STRING\":\"AWSSOLUTION/SO0219/v1.1.11-202503111525\",\"WITH_AUTH_MIDDLEWARE\":\"false\",\"WITH_VALIDATE_ROLE\":\"true\"}},\"Handler\":\"run.sh\",\"Layers\":[{\"Ref\":\"ClickStreamApiLambdaAdapterLayer4456E47F\"}],\"LoggingConfig\":{\"Fn::If\":[\"AWSCNCondition\",{\"Ref\":\"AWS::NoValue\"},{\"ApplicationLogLevel\":\"WARN\",\"LogFormat\":\"JSON\"}]},\"MemorySize\":512,\"Role\":{\"Fn::GetAtt\":[\"ClickStreamApiApiFunctionRole378A2758\",\"Arn\"]},\"Runtime\":{\"Fn::If\":[\"AWSCNCondition\",\"nodejs18.x\",\"nodejs20.x\"]},\"Timeout\":30},\"Type\":\"AWS::Lambda::Function\"},\"ClickStreamApiApiFunctionRole378A2758\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/ApiFunctionRole/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W28\",\"reason\":\"Set the role name with prefix\"}]}},\"Properties\":{\"AssumeRolePolicyDocument\":{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"lambda.amazonaws.com\"}}],\"Version\":\"2012-10-17\"},\"PermissionsBoundary\":{\"Fn::If\":[\"isEmptyPermissionBoundary\",{\"Ref\":\"AWS::NoValue\"},{\"Ref\":\"IamRoleBoundaryArn\"}]},\"RoleName\":{\"Fn::If\":[\"isEmptyRolePrefix\",{\"Ref\":\"AWS::NoValue\"},{\"Fn::Join\":[\"\",[{\"Ref\":\"IamRolePrefix\"},\"-ApiFunctionRole-\",{\"Ref\":\"AWS::Region\"},\"-\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]}]]}]}},\"Type\":\"AWS::IAM::Role\"},\"ClickStreamApiApiFunctionRoleDefaultPolicy7987A2B3\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/ApiFunctionRole/DefaultPolicy/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W76\",\"reason\":\"Policy is generated by ApiFunctionRoleDefaultPolicy which resources SPCM for IAM policy document is higher than 25\"},{\"id\":\"W12\",\"reason\":\"Policy is generated by ApiFunctionRoleDefaultPolicy, * lambda resources for read only access or IAM limitation.\"}]}},\"Properties\":{\"PolicyDocument\":{\"Statement\":[{\"Action\":[\"logs:CreateLogStream\",\"logs:PutLogEvents\",\"logs:CreateLogGroup\"],\"Effect\":\"Allow\",\"Resource\":\"*\"},{\"Action\":\"states:StartExecution\",\"Effect\":\"Allow\",\"Resource\":[{\"Ref\":\"ClickStreamApiStackActionStateMachine21A0158C\"},{\"Ref\":\"ClickStreamApiStackWorkflowStateMachineC5F60F13\"},{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":states:*:\",{\"Ref\":\"AWS::AccountId\"},\":stateMachine:ScanMetadataWorkflow*\"]]},{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":states:*:\",{\"Ref\":\"AWS::AccountId\"},\":stateMachine:ClickstreamUserSegmentsWorkflowStateMachine*\"]]}]},{\"Action\":[\"ec2:DescribeRegions\",\"ec2:DescribeVpcs\",\"ec2:DescribeSecurityGroups\",\"ec2:DescribeSubnets\",\"ec2:DescribeRouteTables\",\"ec2:DescribeVpcEndpoints\",\"ec2:DescribeSecurityGroupRules\",\"ec2:DescribeAvailabilityZones\",\"ec2:DescribeNatGateways\",\"kafka:ListClustersV2\",\"kafka:ListClusters\",\"kafka:ListNodes\",\"s3:ListAllMyBuckets\",\"redshift:DescribeClusters\",\"redshift:DescribeClusterSubnetGroups\",\"redshift-serverless:ListWorkgroups\",\"redshift-serverless:GetWorkgroup\",\"redshift-serverless:GetNamespace\",\"redshift-data:BatchExecuteStatement\",\"s3:ListBucket\",\"s3:GetObject\",\"s3:PutObject\",\"ds:AuthorizeApplication\",\"ds:UnauthorizeApplication\",\"ds:CheckAlias\",\"ds:CreateAlias\",\"ds:DescribeDirectories\",\"ds:DescribeTrusts\",\"ds:DeleteDirectory\",\"ds:CreateIdentityPoolDirectory\",\"s3:GetBucketLocation\",\"s3:GetBucketPolicy\",\"route53:ListHostedZones\",\"iam:ListRoles\",\"iam:ListServerCertificates\",\"iam:GetContextKeysForCustomPolicy\",\"iam:SimulateCustomPolicy\",\"states:DescribeExecution\",\"states:ListExecutions\",\"acm:ListCertificates\",\"cloudformation:DescribeStacks\",\"cloudformation:DescribeType\",\"secretsmanager:ListSecrets\",\"secretsmanager:GetSecretValue\",\"cloudwatch:DescribeAlarms\",\"cloudwatch:EnableAlarmActions\",\"cloudwatch:DisableAlarmActions\",\"events:PutRule\",\"events:ListTargetsByRule\",\"events:PutTargets\",\"events:TagResource\",\"events:UntagResource\",\"sns:CreateTopic\",\"sns:Subscribe\",\"sns:SetTopicAttributes\",\"sns:TagResource\",\"sns:UntagResource\"],\"Effect\":\"Allow\",\"Resource\":\"*\"},{\"Action\":[\"quicksight:UpdateDashboardPermissions\",\"quicksight:CreateDataSet\",\"quicksight:DeleteDataSet\",\"quicksight:PassDataSet\",\"quicksight:PassDataSource\",\"quicksight:CreateDashboard\",\"quicksight:DeleteDashboard\",\"quicksight:UpdateDashboard\",\"quicksight:DescribeDashboard\",\"quicksight:UpdateDashboardPublishedVersion\",\"quicksight:CreateAnalysis\",\"quicksight:UpdateAnalysis\",\"quicksight:DeleteAnalysis\",\"quicksight:CreateFolderMembership\",\"quicksight:ListFolderMembers\",\"quicksight:DescribeFolder\",\"quicksight:CreateFolder\"],\"Effect\":\"Allow\",\"Resource\":[{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":quicksight:*:\",{\"Ref\":\"AWS::AccountId\"},\":analysis/*\"]]},{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":quicksight:*:\",{\"Ref\":\"AWS::AccountId\"},\":dashboard/*\"]]},{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":quicksight:*:\",{\"Ref\":\"AWS::AccountId\"},\":dataset/*\"]]},{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":quicksight:*:\",{\"Ref\":\"AWS::AccountId\"},\":datasource/*\"]]},{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":quicksight:*:\",{\"Ref\":\"AWS::AccountId\"},\":folder/clickstream*\"]]}]},{\"Action\":[\"quicksight:GenerateEmbedUrlForRegisteredUser\",\"quicksight:RegisterUser\",\"quicksight:DeleteUser\",\"quicksight:ListUsers\",\"quicksight:ListDataSets\",\"quicksight:ListDashboards\",\"quicksight:ListAnalyses\"],\"Effect\":\"Allow\",\"Resource\":[{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":quicksight:*:\",{\"Ref\":\"AWS::AccountId\"},\":analysis/*\"]]},{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":quicksight:*:\",{\"Ref\":\"AWS::AccountId\"},\":dashboard/*\"]]},{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":quicksight:*:\",{\"Ref\":\"AWS::AccountId\"},\":dataset/*\"]]},{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":quicksight:*:\",{\"Ref\":\"AWS::AccountId\"},\":user/*\"]]}]},{\"Action\":\"quicksight:DescribeAccountSubscription\",\"Effect\":\"Allow\",\"Resource\":{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":quicksight:*:\",{\"Ref\":\"AWS::AccountId\"},\":*\"]]}},{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Resource\":{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":iam::\",{\"Ref\":\"AWS::AccountId\"},\":role/\",{\"Fn::If\":[\"IsEmptyRolePrefixCondition\",\"Clickstream\",{\"Ref\":\"IamRolePrefix\"}]},\"*\"]]}},{\"Action\":[\"events:RemoveTargets\",\"events:DeleteRule\"],\"Effect\":\"Allow\",\"Resource\":{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":events:*:\",{\"Ref\":\"AWS::AccountId\"},\":rule/Clickstream-SegmentJobRule-*\"]]}},{\"Action\":\"iam:PassRole\",\"Effect\":\"Allow\",\"Resource\":{\"Fn::GetAtt\":[\"ClickStreamApiApiFunctionRole378A2758\",\"Arn\"]}},{\"Action\":[\"dynamodb:BatchGetItem\",\"dynamodb:GetRecords\",\"dynamodb:GetShardIterator\",\"dynamodb:Query\",\"dynamodb:GetItem\",\"dynamodb:Scan\",\"dynamodb:ConditionCheckItem\",\"dynamodb:BatchWriteItem\",\"dynamodb:PutItem\",\"dynamodb:UpdateItem\",\"dynamodb:DeleteItem\",\"dynamodb:DescribeTable\"],\"Effect\":\"Allow\",\"Resource\":[{\"Fn::GetAtt\":[\"ClickStreamApiClickstreamDictionaryFDA4AD32\",\"Arn\"]},{\"Ref\":\"AWS::NoValue\"}]},{\"Action\":[\"dynamodb:BatchGetItem\",\"dynamodb:GetRecords\",\"dynamodb:GetShardIterator\",\"dynamodb:Query\",\"dynamodb:GetItem\",\"dynamodb:Scan\",\"dynamodb:ConditionCheckItem\",\"dynamodb:BatchWriteItem\",\"dynamodb:PutItem\",\"dynamodb:UpdateItem\",\"dynamodb:DeleteItem\",\"dynamodb:DescribeTable\"],\"Effect\":\"Allow\",\"Resource\":[{\"Fn::GetAtt\":[\"ClickStreamApiClickstreamMetadataEC136DD8\",\"Arn\"]},{\"Fn::Join\":[\"\",[{\"Fn::GetAtt\":[\"ClickStreamApiClickstreamMetadataEC136DD8\",\"Arn\"]},\"/index/*\"]]}]},{\"Action\":[\"dynamodb:BatchGetItem\",\"dynamodb:GetRecords\",\"dynamodb:GetShardIterator\",\"dynamodb:Query\",\"dynamodb:GetItem\",\"dynamodb:Scan\",\"dynamodb:ConditionCheckItem\",\"dynamodb:BatchWriteItem\",\"dynamodb:PutItem\",\"dynamodb:UpdateItem\",\"dynamodb:DeleteItem\",\"dynamodb:DescribeTable\"],\"Effect\":\"Allow\",\"Resource\":[{\"Fn::GetAtt\":[\"ClickStreamApiAnalyticsMetadata4C5E5BA1\",\"Arn\"]},{\"Fn::Join\":[\"\",[{\"Fn::GetAtt\":[\"ClickStreamApiAnalyticsMetadata4C5E5BA1\",\"Arn\"]},\"/index/*\"]]}]}],\"Version\":\"2012-10-17\"},\"PolicyName\":\"ClickStreamApiApiFunctionRoleDefaultPolicy7987A2B3\",\"Roles\":[{\"Ref\":\"ClickStreamApiApiFunctionRole378A2758\"}]},\"Type\":\"AWS::IAM::Policy\"},\"ClickStreamApiBackendEventBusListenStackFuncRole2C62A27A\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/BackendEventBus/ListenStackFuncRole/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W28\",\"reason\":\"Set the role name with prefix\"}]}},\"Properties\":{\"AssumeRolePolicyDocument\":{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"lambda.amazonaws.com\"}}],\"Version\":\"2012-10-17\"},\"PermissionsBoundary\":{\"Fn::If\":[\"isEmptyPermissionBoundary\",{\"Ref\":\"AWS::NoValue\"},{\"Ref\":\"IamRoleBoundaryArn\"}]},\"RoleName\":{\"Fn::If\":[\"isEmptyRolePrefix\",{\"Ref\":\"AWS::NoValue\"},{\"Fn::Join\":[\"\",[{\"Ref\":\"IamRolePrefix\"},\"-ListenStackFuncRole-\",{\"Ref\":\"AWS::Region\"},\"-\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]}]]}]}},\"Type\":\"AWS::IAM::Role\"},\"ClickStreamApiBackendEventBusListenStackFuncRoleDefaultPolicy2E63F180\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/BackendEventBus/ListenStackFuncRole/DefaultPolicy/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W12\",\"reason\":\"The lambda service creates undetermined eni by design\"}]}},\"Properties\":{\"PolicyDocument\":{\"Statement\":[{\"Action\":[\"logs:CreateLogStream\",\"logs:PutLogEvents\",\"logs:CreateLogGroup\"],\"Effect\":\"Allow\",\"Resource\":\"*\"},{\"Action\":[\"ec2:CreateNetworkInterface\",\"ec2:DescribeNetworkInterfaces\",\"ec2:DeleteNetworkInterface\",\"ec2:AssignPrivateIpAddresses\",\"ec2:UnassignPrivateIpAddresses\"],\"Effect\":\"Allow\",\"Resource\":\"*\"},{\"Action\":\"cloudformation:DescribeStacks\",\"Effect\":\"Allow\",\"Resource\":{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":cloudformation:*:\",{\"Ref\":\"AWS::AccountId\"},\":stack/\",{\"Fn::If\":[\"IsEmptyRolePrefixCondition\",\"Clickstream\",{\"Fn::Join\":[\"\",[{\"Ref\":\"IamRolePrefix\"},\"-Clickstream\"]]}]},\"*\"]]}},{\"Action\":[\"sqs:DeleteMessage\",\"sqs:ReceiveMessage\",\"sqs:GetQueueAttributes\"],\"Effect\":\"Allow\",\"Resource\":{\"Fn::GetAtt\":[\"ClickStreamApiBackendEventBusListenStackStatusQueueA9825F84\",\"Arn\"]}},{\"Action\":[\"xray:PutTraceSegments\",\"xray:PutTelemetryRecords\"],\"Effect\":\"Allow\",\"Resource\":\"*\"},{\"Action\":[\"dynamodb:BatchGetItem\",\"dynamodb:GetRecords\",\"dynamodb:GetShardIterator\",\"dynamodb:Query\",\"dynamodb:GetItem\",\"dynamodb:Scan\",\"dynamodb:ConditionCheckItem\",\"dynamodb:BatchWriteItem\",\"dynamodb:PutItem\",\"dynamodb:UpdateItem\",\"dynamodb:DeleteItem\",\"dynamodb:DescribeTable\"],\"Effect\":\"Allow\",\"Resource\":[{\"Fn::GetAtt\":[\"ClickStreamApiClickstreamMetadataEC136DD8\",\"Arn\"]},{\"Fn::Join\":[\"\",[{\"Fn::GetAtt\":[\"ClickStreamApiClickstreamMetadataEC136DD8\",\"Arn\"]},\"/index/*\"]]}]},{\"Action\":[\"sqs:ReceiveMessage\",\"sqs:ChangeMessageVisibility\",\"sqs:GetQueueUrl\",\"sqs:DeleteMessage\",\"sqs:GetQueueAttributes\"],\"Effect\":\"Allow\",\"Resource\":{\"Fn::GetAtt\":[\"ClickStreamApiBackendEventBusListenStackStatusQueueA9825F84\",\"Arn\"]}}],\"Version\":\"2012-10-17\"},\"PolicyName\":\"ClickStreamApiBackendEventBusListenStackFuncRoleDefaultPolicy2E63F180\",\"Roles\":[{\"Ref\":\"ClickStreamApiBackendEventBusListenStackFuncRole2C62A27A\"}]},\"Type\":\"AWS::IAM::Policy\"},\"ClickStreamApiBackendEventBusListenStackFunction2C052556\":{\"DependsOn\":[\"ClickStreamApiBackendEventBusListenStackFuncRoleDefaultPolicy2E63F180\",\"ClickStreamApiBackendEventBusListenStackFuncRole2C62A27A\"],\"Metadata\":{\"aws:asset:is-bundled\":true,\"aws:asset:path\":\"asset.9b38e18c89de49d24d73ea5d21d5ead44e8ed46fd69deae107c9fba94d09ad11\",\"aws:asset:property\":\"Code\",\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/BackendEventBus/ListenStackFunction/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W89\",\"reason\":\"Lambda function is only used by ListenStackFunction for deployment as cloudformation custom resources or per product design, no need to be deployed in VPC\"},{\"id\":\"W92\",\"reason\":\"Lambda function is only used by ListenStackFunction for deployment as cloudformation custom resources or per product design, no need to set ReservedConcurrentExecutions\"}]}},\"Properties\":{\"Architectures\":[\"arm64\"],\"Code\":{\"S3Bucket\":{\"Fn::Sub\":\"solutions-${AWS::Region}\"},\"S3Key\":\"clickstream-analytics-on-aws/v1.1.11/9b38e18c89de49d24d73ea5d21d5ead44e8ed46fd69deae107c9fba94d09ad11.zip\"},\"Description\":\"Lambda function for listen CFN stack status of solution Clickstream Analytics on AWS\",\"Environment\":{\"Variables\":{\"AWS_NODEJS_CONNECTION_REUSE_ENABLED\":\"1\",\"CLICKSTREAM_TABLE_NAME\":{\"Ref\":\"ClickStreamApiClickstreamMetadataEC136DD8\"},\"IAM_ROLE_PREFIX\":{\"Ref\":\"IamRolePrefix\"},\"LOG_LEVEL\":\"WARN\",\"POWERTOOLS_LOGGER_LOG_EVENT\":\"true\",\"POWERTOOLS_LOGGER_SAMPLE_RATE\":\"1\",\"POWERTOOLS_SERVICE_NAME\":\"ClickStreamAnalyticsOnAWS\",\"PREFIX_TIME_GSI_NAME\":\"prefix-time-index\",\"USER_AGENT_STRING\":\"AWSSOLUTION/SO0219/v1.1.11-202503111525\"}},\"Handler\":\"index.handler\",\"LoggingConfig\":{\"Fn::If\":[\"AWSCNCondition\",{\"Ref\":\"AWS::NoValue\"},{\"ApplicationLogLevel\":\"INFO\",\"LogFormat\":\"JSON\",\"LogGroup\":{\"Ref\":\"ClickStreamApiBackendEventBusListenStackFunctionlog2633A0EB\"}}]},\"Role\":{\"Fn::GetAtt\":[\"ClickStreamApiBackendEventBusListenStackFuncRole2C62A27A\",\"Arn\"]},\"Runtime\":{\"Fn::If\":[\"AWSCNCondition\",\"nodejs18.x\",\"nodejs20.x\"]},\"Timeout\":60,\"TracingConfig\":{\"Mode\":\"Active\"}},\"Type\":\"AWS::Lambda::Function\"},\"ClickStreamApiBackendEventBusListenStackFunctionSqsEventSourcecloudfronts3controlplanestackglobalClickStreamApiBackendEventBusListenStackStatusQueueA5B2B65499586CBE\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/BackendEventBus/ListenStackFunction/SqsEventSource:cloudfronts3controlplanestackglobalClickStreamApiBackendEventBusListenStackStatusQueueA5B2B654/Resource\"},\"Properties\":{\"BatchSize\":1,\"EventSourceArn\":{\"Fn::GetAtt\":[\"ClickStreamApiBackendEventBusListenStackStatusQueueA9825F84\",\"Arn\"]},\"FunctionName\":{\"Ref\":\"ClickStreamApiBackendEventBusListenStackFunction2C052556\"}},\"Type\":\"AWS::Lambda::EventSourceMapping\"},\"ClickStreamApiBackendEventBusListenStackFunctionlog2633A0EB\":{\"DeletionPolicy\":\"Delete\",\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/BackendEventBus/ListenStackFunction-log/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W84\",\"reason\":\"Log group data is always encrypted in CloudWatch Logs. By default, CloudWatch Logs uses server-side encryption for the log data at rest.\"}]}},\"Properties\":{\"LogGroupClass\":\"STANDARD\"},\"Type\":\"AWS::Logs::LogGroup\",\"UpdateReplacePolicy\":\"Delete\"},\"ClickStreamApiBackendEventBusListenStackStatusQueueA9825F84\":{\"DeletionPolicy\":\"Delete\",\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/BackendEventBus/ListenStackStatusQueue/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W48\",\"reason\":\"SQS already set SQS_MANAGED encryption\"}]}},\"Properties\":{\"QueueName\":{\"Fn::Join\":[\"\",[\"ClickstreamListenStackStatusChange-\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]}]]},\"RedrivePolicy\":{\"deadLetterTargetArn\":{\"Fn::GetAtt\":[\"ClickStreamApiBackendEventBuslistenStackStatusDLQ94095580\",\"Arn\"]},\"maxReceiveCount\":3},\"SqsManagedSseEnabled\":true,\"VisibilityTimeout\":60},\"Type\":\"AWS::SQS::Queue\",\"UpdateReplacePolicy\":\"Delete\"},\"ClickStreamApiBackendEventBusListenStackStatusQueuePolicyA6D442FF\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/BackendEventBus/ListenStackStatusQueue/Policy/Resource\"},\"Properties\":{\"PolicyDocument\":{\"Statement\":[{\"Action\":\"sqs:*\",\"Condition\":{\"Bool\":{\"aws:SecureTransport\":\"false\"}},\"Effect\":\"Deny\",\"Principal\":{\"AWS\":\"*\"},\"Resource\":{\"Fn::GetAtt\":[\"ClickStreamApiBackendEventBusListenStackStatusQueueA9825F84\",\"Arn\"]}},{\"Action\":\"sqs:SendMessage\",\"Condition\":{\"ArnEquals\":{\"aws:SourceArn\":{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":sns:*:\",{\"Ref\":\"AWS::AccountId\"},\":Clickstream*\"]]}}},\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"sns.amazonaws.com\"},\"Resource\":{\"Fn::GetAtt\":[\"ClickStreamApiBackendEventBusListenStackStatusQueueA9825F84\",\"Arn\"]}}],\"Version\":\"2012-10-17\"},\"Queues\":[{\"Ref\":\"ClickStreamApiBackendEventBusListenStackStatusQueueA9825F84\"}]},\"Type\":\"AWS::SQS::QueuePolicy\"},\"ClickStreamApiBackendEventBusListenStateFuncRoleC2399C89\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/BackendEventBus/ListenStateFuncRole/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W28\",\"reason\":\"Set the role name with prefix\"}]}},\"Properties\":{\"AssumeRolePolicyDocument\":{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"lambda.amazonaws.com\"}}],\"Version\":\"2012-10-17\"},\"PermissionsBoundary\":{\"Fn::If\":[\"isEmptyPermissionBoundary\",{\"Ref\":\"AWS::NoValue\"},{\"Ref\":\"IamRoleBoundaryArn\"}]},\"RoleName\":{\"Fn::If\":[\"isEmptyRolePrefix\",{\"Ref\":\"AWS::NoValue\"},{\"Fn::Join\":[\"\",[{\"Ref\":\"IamRolePrefix\"},\"-ListenStateFuncRole-\",{\"Ref\":\"AWS::Region\"},\"-\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]}]]}]}},\"Type\":\"AWS::IAM::Role\"},\"ClickStreamApiBackendEventBusListenStateFuncRoleDefaultPolicyE8ABDA32\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/BackendEventBus/ListenStateFuncRole/DefaultPolicy/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W12\",\"reason\":\"The lambda service creates undetermined eni by design\"}]}},\"Properties\":{\"PolicyDocument\":{\"Statement\":[{\"Action\":[\"logs:CreateLogStream\",\"logs:PutLogEvents\",\"logs:CreateLogGroup\"],\"Effect\":\"Allow\",\"Resource\":\"*\"},{\"Action\":[\"ec2:CreateNetworkInterface\",\"ec2:DescribeNetworkInterfaces\",\"ec2:DeleteNetworkInterface\",\"ec2:AssignPrivateIpAddresses\",\"ec2:UnassignPrivateIpAddresses\"],\"Effect\":\"Allow\",\"Resource\":\"*\"},{\"Action\":\"cloudformation:DescribeStacks\",\"Effect\":\"Allow\",\"Resource\":{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":cloudformation:*:\",{\"Ref\":\"AWS::AccountId\"},\":stack/\",{\"Fn::If\":[\"IsEmptyRolePrefixCondition\",\"Clickstream\",{\"Fn::Join\":[\"\",[{\"Ref\":\"IamRolePrefix\"},\"-Clickstream\"]]}]},\"*\"]]}},{\"Action\":[\"events:DeleteRule\",\"events:ListTargetsByRule\",\"events:RemoveTargets\"],\"Effect\":\"Allow\",\"Resource\":{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":events:*:\",{\"Ref\":\"AWS::AccountId\"},\":rule/ClickstreamRuleForCFN*\"]]}},{\"Action\":[\"sns:ListSubscriptionsByTopic\",\"sns:DeleteTopic\",\"sns:Unsubscribe\"],\"Effect\":\"Allow\",\"Resource\":{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":sns:*:\",{\"Ref\":\"AWS::AccountId\"},\":ClickstreamTopicForCFN*\"]]}},{\"Action\":[\"xray:PutTraceSegments\",\"xray:PutTelemetryRecords\"],\"Effect\":\"Allow\",\"Resource\":\"*\"},{\"Action\":[\"dynamodb:BatchGetItem\",\"dynamodb:GetRecords\",\"dynamodb:GetShardIterator\",\"dynamodb:Query\",\"dynamodb:GetItem\",\"dynamodb:Scan\",\"dynamodb:ConditionCheckItem\",\"dynamodb:BatchWriteItem\",\"dynamodb:PutItem\",\"dynamodb:UpdateItem\",\"dynamodb:DeleteItem\",\"dynamodb:DescribeTable\"],\"Effect\":\"Allow\",\"Resource\":[{\"Fn::GetAtt\":[\"ClickStreamApiClickstreamMetadataEC136DD8\",\"Arn\"]},{\"Fn::Join\":[\"\",[{\"Fn::GetAtt\":[\"ClickStreamApiClickstreamMetadataEC136DD8\",\"Arn\"]},\"/index/*\"]]}]}],\"Version\":\"2012-10-17\"},\"PolicyName\":\"ClickStreamApiBackendEventBusListenStateFuncRoleDefaultPolicyE8ABDA32\",\"Roles\":[{\"Ref\":\"ClickStreamApiBackendEventBusListenStateFuncRoleC2399C89\"}]},\"Type\":\"AWS::IAM::Policy\"},\"ClickStreamApiBackendEventBusListenStateFunctionE05DD00F\":{\"DependsOn\":[\"ClickStreamApiBackendEventBusListenStateFuncRoleDefaultPolicyE8ABDA32\",\"ClickStreamApiBackendEventBusListenStateFuncRoleC2399C89\"],\"Metadata\":{\"aws:asset:is-bundled\":true,\"aws:asset:path\":\"asset.28f86852eb396092245ff2d78b9cb60177bbcb93514c4d547a61ac3a56af99be\",\"aws:asset:property\":\"Code\",\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/BackendEventBus/ListenStateFunction/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W89\",\"reason\":\"Lambda function is only used by ListenStateFunction for deployment as cloudformation custom resources or per product design, no need to be deployed in VPC\"},{\"id\":\"W92\",\"reason\":\"Lambda function is only used by ListenStateFunction for deployment as cloudformation custom resources or per product design, no need to set ReservedConcurrentExecutions\"}]}},\"Properties\":{\"Architectures\":[\"arm64\"],\"Code\":{\"S3Bucket\":{\"Fn::Sub\":\"solutions-${AWS::Region}\"},\"S3Key\":\"clickstream-analytics-on-aws/v1.1.11/28f86852eb396092245ff2d78b9cb60177bbcb93514c4d547a61ac3a56af99be.zip\"},\"Description\":\"Lambda function for listen SFN state machine status of solution Clickstream Analytics on AWS\",\"Environment\":{\"Variables\":{\"AWS_ACCOUNT_ID\":{\"Ref\":\"AWS::AccountId\"},\"AWS_NODEJS_CONNECTION_REUSE_ENABLED\":\"1\",\"CLICKSTREAM_TABLE_NAME\":{\"Ref\":\"ClickStreamApiClickstreamMetadataEC136DD8\"},\"LOG_LEVEL\":\"WARN\",\"POWERTOOLS_LOGGER_LOG_EVENT\":\"true\",\"POWERTOOLS_LOGGER_SAMPLE_RATE\":\"1\",\"POWERTOOLS_SERVICE_NAME\":\"ClickStreamAnalyticsOnAWS\",\"PREFIX_TIME_GSI_NAME\":\"prefix-time-index\",\"USER_AGENT_STRING\":\"AWSSOLUTION/SO0219/v1.1.11-202503111525\"}},\"Handler\":\"index.handler\",\"LoggingConfig\":{\"Fn::If\":[\"AWSCNCondition\",{\"Ref\":\"AWS::NoValue\"},{\"ApplicationLogLevel\":\"INFO\",\"LogFormat\":\"JSON\",\"LogGroup\":{\"Ref\":\"ClickStreamApiBackendEventBusListenStateFunctionlogC56C857A\"}}]},\"Role\":{\"Fn::GetAtt\":[\"ClickStreamApiBackendEventBusListenStateFuncRoleC2399C89\",\"Arn\"]},\"Runtime\":{\"Fn::If\":[\"AWSCNCondition\",\"nodejs18.x\",\"nodejs20.x\"]},\"Timeout\":60,\"TracingConfig\":{\"Mode\":\"Active\"}},\"Type\":\"AWS::Lambda::Function\"},\"ClickStreamApiBackendEventBusListenStateFunctionlogC56C857A\":{\"DeletionPolicy\":\"Delete\",\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/BackendEventBus/ListenStateFunction-log/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W84\",\"reason\":\"Log group data is always encrypted in CloudWatch Logs. By default, CloudWatch Logs uses server-side encryption for the log data at rest.\"}]}},\"Properties\":{\"LogGroupClass\":\"STANDARD\"},\"Type\":\"AWS::Logs::LogGroup\",\"UpdateReplacePolicy\":\"Delete\"},\"ClickStreamApiBackendEventBusListenStateStatusChange3F69E34F\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/BackendEventBus/ListenStateStatusChange/Resource\"},\"Properties\":{\"Description\":\"Rule for listen SFN state machine status change\",\"EventPattern\":{\"detail\":{\"stateMachineArn\":[{\"Ref\":\"ClickStreamApiStackWorkflowStateMachineC5F60F13\"}]},\"detail-type\":[\"Step Functions Execution Status Change\"],\"resources\":[{\"wildcard\":{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":states:\",{\"Ref\":\"AWS::Region\"},\":\",{\"Ref\":\"AWS::AccountId\"},\":execution:\",{\"Fn::GetAtt\":[\"ClickStreamApiStackWorkflowStateMachineC5F60F13\",\"Name\"]},\":main*\"]]}}],\"source\":[\"aws.states\"]},\"Name\":{\"Fn::Join\":[\"\",[\"ClickstreamListenStateStatusChange-\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]}]]},\"State\":\"ENABLED\",\"Targets\":[{\"Arn\":{\"Fn::GetAtt\":[\"ClickStreamApiBackendEventBusListenStateFunctionE05DD00F\",\"Arn\"]},\"DeadLetterConfig\":{\"Arn\":{\"Fn::GetAtt\":[\"ClickStreamApiBackendEventBuslistenStateStatusDLQ09CDAFD4\",\"Arn\"]}},\"Id\":\"Target0\",\"RetryPolicy\":{\"MaximumEventAgeInSeconds\":7200,\"MaximumRetryAttempts\":2}}]},\"Type\":\"AWS::Events::Rule\"},\"ClickStreamApiBackendEventBusListenStateStatusChangeAllowEventRulecloudfronts3controlplanestackglobalClickStreamApiBackendEventBusListenStateFunctionE55F443AF77E8943\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/BackendEventBus/ListenStateStatusChange/AllowEventRulecloudfronts3controlplanestackglobalClickStreamApiBackendEventBusListenStateFunctionE55F443A\"},\"Properties\":{\"Action\":\"lambda:InvokeFunction\",\"FunctionName\":{\"Fn::GetAtt\":[\"ClickStreamApiBackendEventBusListenStateFunctionE05DD00F\",\"Arn\"]},\"Principal\":\"events.amazonaws.com\",\"SourceArn\":{\"Fn::GetAtt\":[\"ClickStreamApiBackendEventBusListenStateStatusChange3F69E34F\",\"Arn\"]}},\"Type\":\"AWS::Lambda::Permission\"},\"ClickStreamApiBackendEventBuslistenStackStatusDLQ94095580\":{\"DeletionPolicy\":\"Delete\",\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/BackendEventBus/listenStackStatusDLQ/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W48\",\"reason\":\"SQS already set SQS_MANAGED encryption\"}]}},\"Properties\":{\"SqsManagedSseEnabled\":true},\"Type\":\"AWS::SQS::Queue\",\"UpdateReplacePolicy\":\"Delete\"},\"ClickStreamApiBackendEventBuslistenStackStatusDLQPolicy649D7DD8\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/BackendEventBus/listenStackStatusDLQ/Policy/Resource\"},\"Properties\":{\"PolicyDocument\":{\"Statement\":[{\"Action\":\"sqs:*\",\"Condition\":{\"Bool\":{\"aws:SecureTransport\":\"false\"}},\"Effect\":\"Deny\",\"Principal\":{\"AWS\":\"*\"},\"Resource\":{\"Fn::GetAtt\":[\"ClickStreamApiBackendEventBuslistenStackStatusDLQ94095580\",\"Arn\"]}}],\"Version\":\"2012-10-17\"},\"Queues\":[{\"Ref\":\"ClickStreamApiBackendEventBuslistenStackStatusDLQ94095580\"}]},\"Type\":\"AWS::SQS::QueuePolicy\"},\"ClickStreamApiBackendEventBuslistenStateStatusDLQ09CDAFD4\":{\"DeletionPolicy\":\"Delete\",\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/BackendEventBus/listenStateStatusDLQ/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W48\",\"reason\":\"SQS already set SQS_MANAGED encryption\"}]}},\"Properties\":{\"SqsManagedSseEnabled\":true},\"Type\":\"AWS::SQS::Queue\",\"UpdateReplacePolicy\":\"Delete\"},\"ClickStreamApiBackendEventBuslistenStateStatusDLQPolicy59231A44\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/BackendEventBus/listenStateStatusDLQ/Policy/Resource\"},\"Properties\":{\"PolicyDocument\":{\"Statement\":[{\"Action\":\"sqs:*\",\"Condition\":{\"Bool\":{\"aws:SecureTransport\":\"false\"}},\"Effect\":\"Deny\",\"Principal\":{\"AWS\":\"*\"},\"Resource\":{\"Fn::GetAtt\":[\"ClickStreamApiBackendEventBuslistenStateStatusDLQ09CDAFD4\",\"Arn\"]}},{\"Action\":\"sqs:SendMessage\",\"Condition\":{\"ArnEquals\":{\"aws:SourceArn\":{\"Fn::GetAtt\":[\"ClickStreamApiBackendEventBusListenStateStatusChange3F69E34F\",\"Arn\"]}}},\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"events.amazonaws.com\"},\"Resource\":{\"Fn::GetAtt\":[\"ClickStreamApiBackendEventBuslistenStateStatusDLQ09CDAFD4\",\"Arn\"]},\"Sid\":\"AllowEventRulecloudfronts3controlplanestackglobalClickStreamApiBackendEventBusListenStateStatusChangeFB7A15E9\"}],\"Version\":\"2012-10-17\"},\"Queues\":[{\"Ref\":\"ClickStreamApiBackendEventBuslistenStateStatusDLQ09CDAFD4\"}]},\"Type\":\"AWS::SQS::QueuePolicy\"},\"ClickStreamApiBatchInsertDDBCustomResourceDicInitCustomResourceB9A4ABDE\":{\"DeletionPolicy\":\"Delete\",\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/BatchInsertDDBCustomResource/DicInitCustomResource/Default\"},\"Properties\":{\"ServiceToken\":{\"Fn::GetAtt\":[\"ClickStreamApiBatchInsertDDBCustomResourceDicInitCustomResourceProviderframeworkonEventCEE52DB5\",\"Arn\"]},\"lastModifiedTime\":1741708779502,\"tableName\":{\"Ref\":\"ClickStreamApiClickstreamDictionaryFDA4AD32\"}},\"Type\":\"AWS::CloudFormation::CustomResource\",\"UpdateReplacePolicy\":\"Delete\"},\"ClickStreamApiBatchInsertDDBCustomResourceDicInitCustomResourceFunction50F646E7\":{\"DependsOn\":[\"ClickStreamApiBatchInsertDDBCustomResourceDicInitCustomResourceRoleDefaultPolicy51DD59EC\",\"ClickStreamApiBatchInsertDDBCustomResourceDicInitCustomResourceRoleF6845D40\"],\"Metadata\":{\"aws:asset:is-bundled\":true,\"aws:asset:path\":\"asset.4b829ca2a7bec17cda16a2d85395908a8e1648cced4dc3f8eab1fca9ebb0377d\",\"aws:asset:property\":\"Code\",\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/BatchInsertDDBCustomResource/DicInitCustomResourceFunction/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W89\",\"reason\":\"Lambda function is only used by DicInitCustomResourceFunction for deployment as cloudformation custom resources or per product design, no need to be deployed in VPC\"},{\"id\":\"W92\",\"reason\":\"Lambda function is only used by DicInitCustomResourceFunction for deployment as cloudformation custom resources or per product design, no need to set ReservedConcurrentExecutions\"}]}},\"Properties\":{\"Architectures\":[\"arm64\"],\"Code\":{\"S3Bucket\":{\"Fn::Sub\":\"solutions-${AWS::Region}\"},\"S3Key\":\"clickstream-analytics-on-aws/v1.1.11/4b829ca2a7bec17cda16a2d85395908a8e1648cced4dc3f8eab1fca9ebb0377d.zip\"},\"Description\":\"Lambda function for dictionary init of solution Click Stream Analytics on AWS\",\"Environment\":{\"Variables\":{\"AWS_NODEJS_CONNECTION_REUSE_ENABLED\":\"1\",\"LOG_LEVEL\":\"WARN\",\"POWERTOOLS_LOGGER_LOG_EVENT\":\"true\",\"POWERTOOLS_LOGGER_SAMPLE_RATE\":\"1\",\"POWERTOOLS_SERVICE_NAME\":\"ClickStreamAnalyticsOnAWS\",\"USER_AGENT_STRING\":\"AWSSOLUTION/SO0219/v1.1.11-202503111525\"}},\"Handler\":\"index.handler\",\"LoggingConfig\":{\"Fn::If\":[\"AWSCNCondition\",{\"Ref\":\"AWS::NoValue\"},{\"ApplicationLogLevel\":\"INFO\",\"LogFormat\":\"JSON\",\"LogGroup\":{\"Ref\":\"ClickStreamApiBatchInsertDDBCustomResourceDicInitCustomResourceFunctionlogFE6EA5E2\"}}]},\"MemorySize\":256,\"Role\":{\"Fn::GetAtt\":[\"ClickStreamApiBatchInsertDDBCustomResourceDicInitCustomResourceRoleF6845D40\",\"Arn\"]},\"Runtime\":{\"Fn::If\":[\"AWSCNCondition\",\"nodejs18.x\",\"nodejs20.x\"]},\"Timeout\":30},\"Type\":\"AWS::Lambda::Function\"},\"ClickStreamApiBatchInsertDDBCustomResourceDicInitCustomResourceFunctionlogFE6EA5E2\":{\"DeletionPolicy\":\"Delete\",\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/BatchInsertDDBCustomResource/DicInitCustomResourceFunction-log/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W84\",\"reason\":\"Log group data is always encrypted in CloudWatch Logs. By default, CloudWatch Logs uses server-side encryption for the log data at rest.\"}]}},\"Properties\":{\"LogGroupClass\":\"STANDARD\"},\"Type\":\"AWS::Logs::LogGroup\",\"UpdateReplacePolicy\":\"Delete\"},\"ClickStreamApiBatchInsertDDBCustomResourceDicInitCustomResourceProviderframeworkonEventCEE52DB5\":{\"DependsOn\":[\"ClickStreamApiBatchInsertDDBCustomResourceDicInitCustomResourceProviderframeworkonEventServiceRoleDefaultPolicy4B5DBE85\",\"ClickStreamApiBatchInsertDDBCustomResourceDicInitCustomResourceProviderframeworkonEventServiceRole124C5C94\"],\"Metadata\":{\"aws:asset:is-bundled\":false,\"aws:asset:path\":\"asset.3542be390685e0c8353d92ccb5796d343cd93ca946b6b0de798004206a199adc\",\"aws:asset:property\":\"Code\",\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/BatchInsertDDBCustomResource/DicInitCustomResourceProvider/framework-onEvent/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W89\",\"reason\":\"Lambda function is only used by CDK built-in provider for DicInitCustomResourceProvider for deployment as cloudformation custom resources or per product design, no need to be deployed in VPC\"},{\"id\":\"W92\",\"reason\":\"Lambda function is only used by CDK built-in provider for DicInitCustomResourceProvider for deployment as cloudformation custom resources or per product design, no need to set ReservedConcurrentExecutions\"}]}},\"Properties\":{\"Code\":{\"S3Bucket\":{\"Fn::Sub\":\"solutions-${AWS::Region}\"},\"S3Key\":\"clickstream-analytics-on-aws/v1.1.11/3542be390685e0c8353d92ccb5796d343cd93ca946b6b0de798004206a199adc.zip\"},\"Description\":\"AWS CDK resource provider framework - onEvent (cloudfront-s3-control-plane-stack-global/ClickStreamApi/BatchInsertDDBCustomResource/DicInitCustomResourceProvider)\",\"Environment\":{\"Variables\":{\"USER_AGENT_STRING\":\"AWSSOLUTION/SO0219/v1.1.11-202503111525\",\"USER_ON_EVENT_FUNCTION_ARN\":{\"Fn::GetAtt\":[\"ClickStreamApiBatchInsertDDBCustomResourceDicInitCustomResourceFunction50F646E7\",\"Arn\"]}}},\"Handler\":\"framework.onEvent\",\"Role\":{\"Fn::GetAtt\":[\"ClickStreamApiBatchInsertDDBCustomResourceDicInitCustomResourceProviderframeworkonEventServiceRole124C5C94\",\"Arn\"]},\"Runtime\":\"nodejs18.x\",\"Timeout\":900},\"Type\":\"AWS::Lambda::Function\"},\"ClickStreamApiBatchInsertDDBCustomResourceDicInitCustomResourceProviderframeworkonEventServiceRole124C5C94\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/BatchInsertDDBCustomResource/DicInitCustomResourceProvider/framework-onEvent/ServiceRole/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W28\",\"reason\":\"Set the role name with prefix\"}]}},\"Properties\":{\"AssumeRolePolicyDocument\":{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"lambda.amazonaws.com\"}}],\"Version\":\"2012-10-17\"},\"ManagedPolicyArns\":[{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\"]]}],\"PermissionsBoundary\":{\"Fn::If\":[\"isEmptyPermissionBoundary\",{\"Ref\":\"AWS::NoValue\"},{\"Ref\":\"IamRoleBoundaryArn\"}]},\"RoleName\":{\"Fn::If\":[\"isEmptyRolePrefix\",{\"Ref\":\"AWS::NoValue\"},{\"Fn::Join\":[\"\",[{\"Ref\":\"IamRolePrefix\"},\"--onEventServiceRole-\",{\"Ref\":\"AWS::Region\"},\"-\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]}]]}]}},\"Type\":\"AWS::IAM::Role\"},\"ClickStreamApiBatchInsertDDBCustomResourceDicInitCustomResourceProviderframeworkonEventServiceRoleDefaultPolicy4B5DBE85\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/BatchInsertDDBCustomResource/DicInitCustomResourceProvider/framework-onEvent/ServiceRole/DefaultPolicy/Resource\"},\"Properties\":{\"PolicyDocument\":{\"Statement\":[{\"Action\":\"lambda:InvokeFunction\",\"Effect\":\"Allow\",\"Resource\":[{\"Fn::GetAtt\":[\"ClickStreamApiBatchInsertDDBCustomResourceDicInitCustomResourceFunction50F646E7\",\"Arn\"]},{\"Fn::Join\":[\"\",[{\"Fn::GetAtt\":[\"ClickStreamApiBatchInsertDDBCustomResourceDicInitCustomResourceFunction50F646E7\",\"Arn\"]},\":*\"]]}]}],\"Version\":\"2012-10-17\"},\"PolicyName\":\"ClickStreamApiBatchInsertDDBCustomResourceDicInitCustomResourceProviderframeworkonEventServiceRoleDefaultPolicy4B5DBE85\",\"Roles\":[{\"Ref\":\"ClickStreamApiBatchInsertDDBCustomResourceDicInitCustomResourceProviderframeworkonEventServiceRole124C5C94\"}]},\"Type\":\"AWS::IAM::Policy\"},\"ClickStreamApiBatchInsertDDBCustomResourceDicInitCustomResourceRoleDefaultPolicy51DD59EC\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/BatchInsertDDBCustomResource/DicInitCustomResourceRole/DefaultPolicy/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W12\",\"reason\":\"The lambda service writes to undetermined logs stream by design\"}]}},\"Properties\":{\"PolicyDocument\":{\"Statement\":[{\"Action\":[\"logs:CreateLogStream\",\"logs:PutLogEvents\",\"logs:CreateLogGroup\"],\"Effect\":\"Allow\",\"Resource\":\"*\"},{\"Action\":[\"dynamodb:BatchGetItem\",\"dynamodb:GetRecords\",\"dynamodb:GetShardIterator\",\"dynamodb:Query\",\"dynamodb:GetItem\",\"dynamodb:Scan\",\"dynamodb:ConditionCheckItem\",\"dynamodb:BatchWriteItem\",\"dynamodb:PutItem\",\"dynamodb:UpdateItem\",\"dynamodb:DeleteItem\",\"dynamodb:DescribeTable\"],\"Effect\":\"Allow\",\"Resource\":[{\"Fn::GetAtt\":[\"ClickStreamApiClickstreamDictionaryFDA4AD32\",\"Arn\"]},{\"Ref\":\"AWS::NoValue\"}]}],\"Version\":\"2012-10-17\"},\"PolicyName\":\"ClickStreamApiBatchInsertDDBCustomResourceDicInitCustomResourceRoleDefaultPolicy51DD59EC\",\"Roles\":[{\"Ref\":\"ClickStreamApiBatchInsertDDBCustomResourceDicInitCustomResourceRoleF6845D40\"}]},\"Type\":\"AWS::IAM::Policy\"},\"ClickStreamApiBatchInsertDDBCustomResourceDicInitCustomResourceRoleF6845D40\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/BatchInsertDDBCustomResource/DicInitCustomResourceRole/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W28\",\"reason\":\"Set the role name with prefix\"}]}},\"Properties\":{\"AssumeRolePolicyDocument\":{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"lambda.amazonaws.com\"}}],\"Version\":\"2012-10-17\"},\"PermissionsBoundary\":{\"Fn::If\":[\"isEmptyPermissionBoundary\",{\"Ref\":\"AWS::NoValue\"},{\"Ref\":\"IamRoleBoundaryArn\"}]},\"RoleName\":{\"Fn::If\":[\"isEmptyRolePrefix\",{\"Ref\":\"AWS::NoValue\"},{\"Fn::Join\":[\"\",[{\"Ref\":\"IamRolePrefix\"},\"-tCustomResourceRole-\",{\"Ref\":\"AWS::Region\"},\"-\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]}]]}]}},\"Type\":\"AWS::IAM::Role\"},\"ClickStreamApiClickStreamApiUsagePlan731D8407\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/ClickStreamApi/ClickStreamApiUsagePlan/Resource\"},\"Properties\":{\"ApiStages\":[{\"ApiId\":{\"Ref\":\"ClickStreamApi748490D9\"},\"Stage\":{\"Ref\":\"ClickStreamApiDeploymentStageapi40499B1B\"},\"Throttle\":{}}],\"Throttle\":{\"BurstLimit\":100,\"RateLimit\":50}},\"Type\":\"AWS::ApiGateway::UsagePlan\"},\"ClickStreamApiClickstreamDictionaryFDA4AD32\":{\"DeletionPolicy\":\"Delete\",\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/ClickstreamDictionary/Resource\"},\"Properties\":{\"AttributeDefinitions\":[{\"AttributeName\":\"name\",\"AttributeType\":\"S\"}],\"BillingMode\":\"PAY_PER_REQUEST\",\"KeySchema\":[{\"AttributeName\":\"name\",\"KeyType\":\"HASH\"}],\"PointInTimeRecoverySpecification\":{\"PointInTimeRecoveryEnabled\":true},\"SSESpecification\":{\"SSEEnabled\":true}},\"Type\":\"AWS::DynamoDB::Table\",\"UpdateReplacePolicy\":\"Delete\"},\"ClickStreamApiClickstreamMetadataEC136DD8\":{\"DeletionPolicy\":\"Delete\",\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/ClickstreamMetadata/Resource\"},\"Properties\":{\"AttributeDefinitions\":[{\"AttributeName\":\"id\",\"AttributeType\":\"S\"},{\"AttributeName\":\"type\",\"AttributeType\":\"S\"},{\"AttributeName\":\"prefix\",\"AttributeType\":\"S\"},{\"AttributeName\":\"createAt\",\"AttributeType\":\"N\"}],\"BillingMode\":\"PAY_PER_REQUEST\",\"GlobalSecondaryIndexes\":[{\"IndexName\":\"prefix-time-index\",\"KeySchema\":[{\"AttributeName\":\"prefix\",\"KeyType\":\"HASH\"},{\"AttributeName\":\"createAt\",\"KeyType\":\"RANGE\"}],\"Projection\":{\"ProjectionType\":\"ALL\"}}],\"KeySchema\":[{\"AttributeName\":\"id\",\"KeyType\":\"HASH\"},{\"AttributeName\":\"type\",\"KeyType\":\"RANGE\"}],\"PointInTimeRecoverySpecification\":{\"PointInTimeRecoveryEnabled\":true},\"SSESpecification\":{\"SSEEnabled\":true},\"TimeToLiveSpecification\":{\"AttributeName\":\"ttl\",\"Enabled\":true}},\"Type\":\"AWS::DynamoDB::Table\",\"UpdateReplacePolicy\":\"Delete\"},\"ClickStreamApiCloudWatchRole5F1F73C6\":{\"DeletionPolicy\":\"Retain\",\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/ClickStreamApi/CloudWatchRole/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W28\",\"reason\":\"Set the role name with prefix\"}]}},\"Properties\":{\"AssumeRolePolicyDocument\":{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"apigateway.amazonaws.com\"}}],\"Version\":\"2012-10-17\"},\"ManagedPolicyArns\":[{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":iam::aws:policy/service-role/AmazonAPIGatewayPushToCloudWatchLogs\"]]}],\"PermissionsBoundary\":{\"Fn::If\":[\"isEmptyPermissionBoundary\",{\"Ref\":\"AWS::NoValue\"},{\"Ref\":\"IamRoleBoundaryArn\"}]},\"RoleName\":{\"Fn::If\":[\"isEmptyRolePrefix\",{\"Ref\":\"AWS::NoValue\"},{\"Fn::Join\":[\"\",[{\"Ref\":\"IamRolePrefix\"},\"-CloudWatchRole-\",{\"Ref\":\"AWS::Region\"},\"-\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]}]]}]}},\"Type\":\"AWS::IAM::Role\",\"UpdateReplacePolicy\":\"Retain\"},\"ClickStreamApiDeploymentB63E2217425b193204363d2c31eaca1e9d46f87b\":{\"DependsOn\":[\"ClickStreamApiproxyANY2008788F\",\"ClickStreamApiproxyC314E806\",\"ClickStreamApiANY82946512\"],\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/ClickStreamApi/Deployment/Resource\"},\"Properties\":{\"Description\":\"Automatically created by the RestApi construct\",\"RestApiId\":{\"Ref\":\"ClickStreamApi748490D9\"}},\"Type\":\"AWS::ApiGateway::Deployment\"},\"ClickStreamApiDeploymentStageapi40499B1B\":{\"DependsOn\":[\"ClickStreamApiAccount2E4BAA6C\"],\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/ClickStreamApi/DeploymentStage.api/Resource\"},\"Properties\":{\"AccessLogSetting\":{\"DestinationArn\":{\"Fn::GetAtt\":[\"ClickStreamApiLogGroup4497C29B\",\"Arn\"]},\"Format\":\"$context.identity.sourceIp $context.identity.caller $context.identity.user [$context.requestTime] \\\"$context.httpMethod $context.resourcePath $context.protocol\\\" $context.status $context.responseLength $context.requestId\"},\"DeploymentId\":{\"Ref\":\"ClickStreamApiDeploymentB63E2217425b193204363d2c31eaca1e9d46f87b\"},\"MethodSettings\":[{\"DataTraceEnabled\":false,\"HttpMethod\":\"*\",\"LoggingLevel\":\"ERROR\",\"MetricsEnabled\":true,\"ResourcePath\":\"/*\"}],\"RestApiId\":{\"Ref\":\"ClickStreamApi748490D9\"},\"StageName\":\"api\",\"TracingEnabled\":true},\"Type\":\"AWS::ApiGateway::Stage\"},\"ClickStreamApiLambdaAdapterLayer4456E47F\":{\"Metadata\":{\"aws:asset:is-bundled\":false,\"aws:asset:path\":\"asset.172d69d35a126d7901ad2947a219793f8764b0b56702c2b0c860a28b5ceb021f\",\"aws:asset:property\":\"Content\",\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/LambdaAdapterLayer/Resource\"},\"Properties\":{\"CompatibleRuntimes\":[\"nodejs16.x\",\"nodejs18.x\",\"nodejs20.x\",\"nodejs18.x\"],\"Content\":{\"S3Bucket\":{\"Fn::Sub\":\"solutions-${AWS::Region}\"},\"S3Key\":\"clickstream-analytics-on-aws/v1.1.11/172d69d35a126d7901ad2947a219793f8764b0b56702c2b0c860a28b5ceb021f.zip\"}},\"Type\":\"AWS::Lambda::LayerVersion\"},\"ClickStreamApiLogGroup4497C29B\":{\"DeletionPolicy\":\"Retain\",\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/LogGroup/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W84\",\"reason\":\"Log group data is always encrypted in CloudWatch Logs. By default, CloudWatch Logs uses server-side encryption for the log data at rest.\"}]}},\"Properties\":{\"LogGroupName\":{\"Fn::Join\":[\"\",[\"clickstream-loggroup-\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]}]]}},\"Type\":\"AWS::Logs::LogGroup\",\"UpdateReplacePolicy\":\"Retain\"},\"ClickStreamApiQuickSightEmbedRole56794DF9\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/QuickSightEmbedRole/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W28\",\"reason\":\"Set the role name with prefix\"}]}},\"Properties\":{\"AssumeRolePolicyDocument\":{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"lambda.amazonaws.com\"}}],\"Version\":\"2012-10-17\"},\"PermissionsBoundary\":{\"Fn::If\":[\"isEmptyPermissionBoundary\",{\"Ref\":\"AWS::NoValue\"},{\"Ref\":\"IamRoleBoundaryArn\"}]},\"Policies\":[{\"PolicyDocument\":{\"Statement\":[{\"Action\":\"quicksight:GenerateEmbedUrlForRegisteredUser\",\"Effect\":\"Allow\",\"Resource\":[{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":quicksight:*:\",{\"Ref\":\"AWS::AccountId\"},\":dashboard/clickstream*\"]]},{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":quicksight:*:\",{\"Ref\":\"AWS::AccountId\"},\":user/*\"]]}]}],\"Version\":\"2012-10-17\"},\"PolicyName\":\"quickSightEmbedPolicy\"}],\"RoleName\":{\"Fn::If\":[\"isEmptyRolePrefix\",{\"Ref\":\"AWS::NoValue\"},{\"Fn::Join\":[\"\",[{\"Ref\":\"IamRolePrefix\"},\"-QuickSightEmbedRole-\",{\"Ref\":\"AWS::Region\"},\"-\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]}]]}]}},\"Type\":\"AWS::IAM::Role\"},\"ClickStreamApiStackActionStateMachine21A0158C\":{\"DeletionPolicy\":\"Delete\",\"DependsOn\":[\"ClickStreamApiStackActionStateMachineRoleDefaultPolicyA311B7F8\",\"ClickStreamApiStackActionStateMachineRole732FABDC\"],\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/StackActionStateMachine/StackActionStateMachine/Resource\"},\"Properties\":{\"DefinitionString\":{\"Fn::Join\":[\"\",[\"{\\\"StartAt\\\":\\\"Execute Task\\\",\\\"States\\\":{\\\"Execute Task\\\":{\\\"Next\\\":\\\"End?\\\",\\\"Retry\\\":[{\\\"ErrorEquals\\\":[\\\"Lambda.ClientExecutionTimeoutException\\\",\\\"Lambda.ServiceException\\\",\\\"Lambda.AWSLambdaException\\\",\\\"Lambda.SdkClientException\\\"],\\\"IntervalSeconds\\\":2,\\\"MaxAttempts\\\":6,\\\"BackoffRate\\\":2}],\\\"Type\\\":\\\"Task\\\",\\\"OutputPath\\\":\\\"$.Payload\\\",\\\"Resource\\\":\\\"arn:\",{\"Ref\":\"AWS::Partition\"},\":states:::lambda:invoke\\\",\\\"Parameters\\\":{\\\"FunctionName\\\":\\\"\",{\"Fn::GetAtt\":[\"ClickStreamApiStackActionStateMachineActionFunction8314F7B4\",\"Arn\"]},\"\\\",\\\"Payload.$\\\":\\\"$\\\"}},\\\"End?\\\":{\\\"Type\\\":\\\"Choice\\\",\\\"Choices\\\":[{\\\"Variable\\\":\\\"$.Action\\\",\\\"StringEquals\\\":\\\"End\\\",\\\"Next\\\":\\\"EndState\\\"}],\\\"Default\\\":\\\"Wait 30 Seconds\\\"},\\\"Wait 30 Seconds\\\":{\\\"Type\\\":\\\"Wait\\\",\\\"Seconds\\\":30,\\\"Next\\\":\\\"Describe Stack\\\"},\\\"Stack in progress?\\\":{\\\"Type\\\":\\\"Choice\\\",\\\"Choices\\\":[{\\\"Variable\\\":\\\"$.Result.StackStatus\\\",\\\"StringMatches\\\":\\\"*_IN_PROGRESS\\\",\\\"Next\\\":\\\"Wait 30 Seconds\\\"}],\\\"Default\\\":\\\"Callback Task\\\"},\\\"Describe Stack\\\":{\\\"Next\\\":\\\"Stack in progress?\\\",\\\"Retry\\\":[{\\\"ErrorEquals\\\":[\\\"Lambda.ClientExecutionTimeoutException\\\",\\\"Lambda.ServiceException\\\",\\\"Lambda.AWSLambdaException\\\",\\\"Lambda.SdkClientException\\\"],\\\"IntervalSeconds\\\":2,\\\"MaxAttempts\\\":6,\\\"BackoffRate\\\":2}],\\\"Type\\\":\\\"Task\\\",\\\"OutputPath\\\":\\\"$.Payload\\\",\\\"Resource\\\":\\\"arn:\",{\"Ref\":\"AWS::Partition\"},\":states:::lambda:invoke\\\",\\\"Parameters\\\":{\\\"FunctionName\\\":\\\"\",{\"Fn::GetAtt\":[\"ClickStreamApiStackActionStateMachineActionFunction8314F7B4\",\"Arn\"]},\"\\\",\\\"Payload.$\\\":\\\"$\\\"}},\\\"Callback Task\\\":{\\\"Next\\\":\\\"EndState\\\",\\\"Retry\\\":[{\\\"ErrorEquals\\\":[\\\"Lambda.ClientExecutionTimeoutException\\\",\\\"Lambda.ServiceException\\\",\\\"Lambda.AWSLambdaException\\\",\\\"Lambda.SdkClientException\\\"],\\\"IntervalSeconds\\\":2,\\\"MaxAttempts\\\":6,\\\"BackoffRate\\\":2}],\\\"Type\\\":\\\"Task\\\",\\\"OutputPath\\\":\\\"$.Payload\\\",\\\"Resource\\\":\\\"arn:\",{\"Ref\":\"AWS::Partition\"},\":states:::lambda:invoke\\\",\\\"Parameters\\\":{\\\"FunctionName\\\":\\\"\",{\"Fn::GetAtt\":[\"ClickStreamApiStackActionStateMachineActionFunction8314F7B4\",\"Arn\"]},\"\\\",\\\"Payload.$\\\":\\\"$\\\"}},\\\"EndState\\\":{\\\"Type\\\":\\\"Pass\\\",\\\"End\\\":true}},\\\"TimeoutSeconds\\\":7200}\"]]},\"LoggingConfiguration\":{\"Destinations\":[{\"CloudWatchLogsLogGroup\":{\"LogGroupArn\":{\"Fn::GetAtt\":[\"ClickStreamApiStackActionStateMachineLogGroupEB2C2181\",\"Arn\"]}}}],\"Level\":\"ALL\"},\"RoleArn\":{\"Fn::GetAtt\":[\"ClickStreamApiStackActionStateMachineRole732FABDC\",\"Arn\"]},\"TracingConfiguration\":{\"Enabled\":true}},\"Type\":\"AWS::StepFunctions::StateMachine\",\"UpdateReplacePolicy\":\"Delete\"},\"ClickStreamApiStackActionStateMachineActionFunction8314F7B4\":{\"DependsOn\":[\"ClickStreamApiStackActionStateMachineActionFunctionRoleDefaultPolicy602A4F26\",\"ClickStreamApiStackActionStateMachineActionFunctionRole4D44D7D2\"],\"Metadata\":{\"aws:asset:is-bundled\":true,\"aws:asset:path\":\"asset.1170f23ac462991fbdb4807f5bc04350390ddd8396c25961d129ee28093031bb\",\"aws:asset:property\":\"Code\",\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/StackActionStateMachine/ActionFunction/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W89\",\"reason\":\"Lambda function is only used by ActionFunction for deployment as cloudformation custom resources or per product design, no need to be deployed in VPC\"},{\"id\":\"W92\",\"reason\":\"Lambda function is only used by ActionFunction for deployment as cloudformation custom resources or per product design, no need to set ReservedConcurrentExecutions\"}]}},\"Properties\":{\"Architectures\":[\"arm64\"],\"Code\":{\"S3Bucket\":{\"Fn::Sub\":\"solutions-${AWS::Region}\"},\"S3Key\":\"clickstream-analytics-on-aws/v1.1.11/1170f23ac462991fbdb4807f5bc04350390ddd8396c25961d129ee28093031bb.zip\"},\"Description\":\"Lambda function for state machine action of solution Clickstream Analytics on AWS\",\"Environment\":{\"Variables\":{\"AWS_NODEJS_CONNECTION_REUSE_ENABLED\":\"1\",\"LOG_LEVEL\":\"WARN\",\"POWERTOOLS_LOGGER_LOG_EVENT\":\"true\",\"POWERTOOLS_LOGGER_SAMPLE_RATE\":\"1\",\"POWERTOOLS_SERVICE_NAME\":\"ClickStreamAnalyticsOnAWS\",\"USER_AGENT_STRING\":\"AWSSOLUTION/SO0219/v1.1.11-202503111525\"}},\"Handler\":\"index.handler\",\"LoggingConfig\":{\"Fn::If\":[\"AWSCNCondition\",{\"Ref\":\"AWS::NoValue\"},{\"ApplicationLogLevel\":\"INFO\",\"LogFormat\":\"JSON\",\"LogGroup\":{\"Ref\":\"ClickStreamApiStackActionStateMachineActionFunctionlogBB41565F\"}}]},\"Role\":{\"Fn::GetAtt\":[\"ClickStreamApiStackActionStateMachineActionFunctionRole4D44D7D2\",\"Arn\"]},\"Runtime\":{\"Fn::If\":[\"AWSCNCondition\",\"nodejs18.x\",\"nodejs20.x\"]},\"Timeout\":15,\"TracingConfig\":{\"Mode\":\"Active\"}},\"Type\":\"AWS::Lambda::Function\"},\"ClickStreamApiStackActionStateMachineActionFunctionRole4D44D7D2\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/StackActionStateMachine/ActionFunctionRole/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W28\",\"reason\":\"Set the role name with prefix\"}]}},\"Properties\":{\"AssumeRolePolicyDocument\":{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"lambda.amazonaws.com\"}}],\"Version\":\"2012-10-17\"},\"PermissionsBoundary\":{\"Fn::If\":[\"isEmptyPermissionBoundary\",{\"Ref\":\"AWS::NoValue\"},{\"Ref\":\"IamRoleBoundaryArn\"}]},\"RoleName\":{\"Fn::If\":[\"isEmptyRolePrefix\",{\"Ref\":\"AWS::NoValue\"},{\"Fn::Join\":[\"\",[{\"Ref\":\"IamRolePrefix\"},\"-ActionFunctionRole-\",{\"Ref\":\"AWS::Region\"},\"-\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]}]]}]}},\"Type\":\"AWS::IAM::Role\"},\"ClickStreamApiStackActionStateMachineActionFunctionRoleDefaultPolicy602A4F26\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/StackActionStateMachine/ActionFunctionRole/DefaultPolicy/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W76\",\"reason\":\"Policy is generated by DefaultPolicy which resources SPCM for IAM policy document is higher than 25\"},{\"id\":\"F4\",\"reason\":\"Policy is generated by ActionFunctionRole, this policy requires related actions in order to start/delete/update cloudformation stacks with many other services\"},{\"id\":\"W12\",\"reason\":\"Policy is generated by DefaultPolicy, * states resources for read only access or IAM limitation.\"}]}},\"Properties\":{\"PolicyDocument\":{\"Statement\":[{\"Action\":[\"logs:CreateLogStream\",\"logs:PutLogEvents\",\"logs:CreateLogGroup\"],\"Effect\":\"Allow\",\"Resource\":\"*\"},{\"Action\":[\"cloudformation:CreateStack\",\"cloudformation:UpdateStack\",\"cloudformation:DeleteStack\",\"cloudformation:DescribeStacks\",\"cloudformation:UpdateTerminationProtection\",\"cloudformation:ContinueUpdateRollback\",\"cloudformation:RollbackStack\"],\"Effect\":\"Allow\",\"Resource\":{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":cloudformation:*:\",{\"Ref\":\"AWS::AccountId\"},\":stack/\",{\"Fn::If\":[\"IsEmptyRolePrefixCondition\",\"Clickstream\",{\"Fn::Join\":[\"\",[{\"Ref\":\"IamRolePrefix\"},\"-Clickstream\"]]}]},\"*\"]]}},{\"Action\":[\"iam:GetRole\",\"iam:PassRole\",\"iam:DetachRolePolicy\",\"iam:GetPolicy\",\"iam:DeleteRolePolicy\",\"iam:CreateRole\",\"iam:DeleteRole\",\"iam:AttachRolePolicy\",\"iam:PutRolePolicy\",\"iam:ListRolePolicies\",\"iam:GetRolePolicy\",\"iam:CreateInstanceProfile\",\"iam:DeleteInstanceProfile\",\"iam:GetInstanceProfile\",\"iam:RemoveRoleFromInstanceProfile\",\"iam:AddRoleToInstanceProfile\",\"iam:ListPolicies\",\"iam:ListRoles\",\"iam:UpdateRoleDescription\",\"iam:TagRole\",\"iam:UntagRole\",\"iam:ListRoleTags\",\"iam:UpdateAssumeRolePolicy\"],\"Effect\":\"Allow\",\"Resource\":[{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":iam::\",{\"Ref\":\"AWS::AccountId\"},\":role/\",{\"Fn::If\":[\"IsEmptyRolePrefixCondition\",\"Clickstream\",{\"Ref\":\"IamRolePrefix\"}]},\"*\"]]},{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":iam::\",{\"Ref\":\"AWS::AccountId\"},\":policy/\",{\"Fn::If\":[\"IsEmptyRolePrefixCondition\",\"Clickstream\",{\"Ref\":\"IamRolePrefix\"}]},\"*\"]]},{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":iam::\",{\"Ref\":\"AWS::AccountId\"},\":instance-profile/\",{\"Fn::If\":[\"IsEmptyRolePrefixCondition\",\"Clickstream\",{\"Ref\":\"IamRolePrefix\"}]},\"*\"]]}]},{\"Action\":[\"iam:PassRole\",\"iam:CreateServiceLinkedRole\"],\"Effect\":\"Allow\",\"Resource\":[{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":iam::\",{\"Ref\":\"AWS::AccountId\"},\":role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService\"]]},{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":iam::\",{\"Ref\":\"AWS::AccountId\"},\":role/aws-service-role/autoscaling.amazonaws.com/AWSServiceRoleForAutoScaling\"]]},{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":iam::\",{\"Ref\":\"AWS::AccountId\"},\":role/aws-service-role/ecs.amazonaws.com/AWSServiceRoleForECS\"]]},{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":iam::\",{\"Ref\":\"AWS::AccountId\"},\":role/aws-service-role/elasticloadbalancing.amazonaws.com/AWSServiceRoleForElasticLoadBalancing\"]]},{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":iam::\",{\"Ref\":\"AWS::AccountId\"},\":role/aws-service-role/globalaccelerator.amazonaws.com/AWSServiceRoleForGlobalAccelerator\"]]},{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":iam::\",{\"Ref\":\"AWS::AccountId\"},\":role/aws-service-role/servicecatalog-appregistry.amazonaws.com/AWSServiceRoleForAWSServiceCatalogAppRegistry\"]]}]},{\"Action\":[\"resource-groups:GetGroup\",\"resource-groups:DisassociateResource\"],\"Effect\":\"Allow\",\"Resource\":{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":resource-groups:*:\",{\"Ref\":\"AWS::AccountId\"},\":group/AWS_AppRegistry_Application-clickstream-analytics-*\"]]}},{\"Action\":[\"sns:*\",\"sqs:*\",\"redshift-serverless:*\",\"s3:*\",\"apigateway:*\",\"logs:*\",\"redshift:*\",\"dynamodb:*\",\"autoscaling:*\",\"application-autoscaling:*\",\"glue:*\",\"cloudwatch:*\",\"emr-serverless:*\",\"ssm:*\",\"ecs:*\",\"lambda:*\",\"quicksight:*\",\"ec2:*\",\"events:*\",\"elasticloadbalancing:*\",\"kinesis:*\",\"kafka:*\",\"states:*\",\"secretsmanager:*\",\"globalaccelerator:*\",\"kms:*\",\"athena:*\",\"servicecatalog:CreateApplication\",\"servicecatalog:UpdateApplication\",\"servicecatalog:DeleteApplication\",\"servicecatalog:GetApplication\",\"servicecatalog:GetAssociatedResource\",\"servicecatalog:AssociateResource\",\"servicecatalog:DisassociateResource\",\"servicecatalog:TagResource\",\"servicecatalog:UntagResource\",\"tag:GetResources\",\"tag:UntagResources\"],\"Effect\":\"Allow\",\"Resource\":\"*\"},{\"Action\":[\"xray:PutTraceSegments\",\"xray:PutTelemetryRecords\"],\"Effect\":\"Allow\",\"Resource\":\"*\"}],\"Version\":\"2012-10-17\"},\"PolicyName\":\"ClickStreamApiStackActionStateMachineActionFunctionRoleDefaultPolicy602A4F26\",\"Roles\":[{\"Ref\":\"ClickStreamApiStackActionStateMachineActionFunctionRole4D44D7D2\"}]},\"Type\":\"AWS::IAM::Policy\"},\"ClickStreamApiStackActionStateMachineActionFunctionlogBB41565F\":{\"DeletionPolicy\":\"Delete\",\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/StackActionStateMachine/ActionFunction-log/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W84\",\"reason\":\"Log group data is always encrypted in CloudWatch Logs. By default, CloudWatch Logs uses server-side encryption for the log data at rest.\"}]}},\"Properties\":{\"LogGroupClass\":\"STANDARD\"},\"Type\":\"AWS::Logs::LogGroup\",\"UpdateReplacePolicy\":\"Delete\"},\"ClickStreamApiStackActionStateMachineLogGroupEB2C2181\":{\"DeletionPolicy\":\"Retain\",\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/StackActionStateMachine/LogGroup/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W84\",\"reason\":\"Log group data is always encrypted in CloudWatch Logs. By default, CloudWatch Logs uses server-side encryption for the log data at rest.\"}]}},\"Properties\":{\"LogGroupName\":{\"Fn::Join\":[\"\",[\"/aws/vendedlogs/states/Clickstream/StackActionLogGroup-\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]}]]}},\"Type\":\"AWS::Logs::LogGroup\",\"UpdateReplacePolicy\":\"Retain\"},\"ClickStreamApiStackActionStateMachineRole732FABDC\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/StackActionStateMachine/StackActionStateMachine/Role/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W28\",\"reason\":\"Set the role name with prefix\"}]}},\"Properties\":{\"AssumeRolePolicyDocument\":{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":{\"Fn::FindInMap\":[\"ServiceprincipalMap\",{\"Ref\":\"AWS::Region\"},\"states\"]}}}],\"Version\":\"2012-10-17\"},\"PermissionsBoundary\":{\"Fn::If\":[\"isEmptyPermissionBoundary\",{\"Ref\":\"AWS::NoValue\"},{\"Ref\":\"IamRoleBoundaryArn\"}]},\"RoleName\":{\"Fn::If\":[\"isEmptyRolePrefix\",{\"Ref\":\"AWS::NoValue\"},{\"Fn::Join\":[\"\",[{\"Ref\":\"IamRolePrefix\"},\"-ionStateMachineRole-\",{\"Ref\":\"AWS::Region\"},\"-\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]}]]}]}},\"Type\":\"AWS::IAM::Role\"},\"ClickStreamApiStackActionStateMachineRoleDefaultPolicyA311B7F8\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/StackActionStateMachine/StackActionStateMachine/Role/DefaultPolicy/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W12\",\"reason\":\"Policy is generated by DefaultPolicy, * states resources for read only access or IAM limitation.\"}]}},\"Properties\":{\"PolicyDocument\":{\"Statement\":[{\"Action\":\"lambda:InvokeFunction\",\"Effect\":\"Allow\",\"Resource\":[{\"Fn::GetAtt\":[\"ClickStreamApiStackActionStateMachineActionFunction8314F7B4\",\"Arn\"]},{\"Fn::Join\":[\"\",[{\"Fn::GetAtt\":[\"ClickStreamApiStackActionStateMachineActionFunction8314F7B4\",\"Arn\"]},\":*\"]]}]},{\"Action\":[\"logs:CreateLogDelivery\",\"logs:GetLogDelivery\",\"logs:UpdateLogDelivery\",\"logs:DeleteLogDelivery\",\"logs:ListLogDeliveries\",\"logs:PutResourcePolicy\",\"logs:DescribeResourcePolicies\",\"logs:DescribeLogGroups\"],\"Effect\":\"Allow\",\"Resource\":\"*\"},{\"Action\":[\"xray:PutTraceSegments\",\"xray:PutTelemetryRecords\",\"xray:GetSamplingRules\",\"xray:GetSamplingTargets\"],\"Effect\":\"Allow\",\"Resource\":\"*\"}],\"Version\":\"2012-10-17\"},\"PolicyName\":\"ClickStreamApiStackActionStateMachineRoleDefaultPolicyA311B7F8\",\"Roles\":[{\"Ref\":\"ClickStreamApiStackActionStateMachineRole732FABDC\"}]},\"Type\":\"AWS::IAM::Policy\"},\"ClickStreamApiStackWorkflowStateMachineC5F60F13\":{\"DeletionPolicy\":\"Delete\",\"DependsOn\":[\"ClickStreamApiStackWorkflowStateMachineRoleDefaultPolicyDCD707BA\",\"ClickStreamApiStackWorkflowStateMachineRoleFD8FA958\"],\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/StackWorkflowStateMachine/StackWorkflowStateMachine/Resource\"},\"Properties\":{\"DefinitionString\":{\"Fn::Join\":[\"\",[\"{\\\"StartAt\\\":\\\"InputTask\\\",\\\"States\\\":{\\\"InputTask\\\":{\\\"Next\\\":\\\"TypeChoice\\\",\\\"Retry\\\":[{\\\"ErrorEquals\\\":[\\\"Lambda.ClientExecutionTimeoutException\\\",\\\"Lambda.ServiceException\\\",\\\"Lambda.AWSLambdaException\\\",\\\"Lambda.SdkClientException\\\"],\\\"IntervalSeconds\\\":2,\\\"MaxAttempts\\\":6,\\\"BackoffRate\\\":2}],\\\"Type\\\":\\\"Task\\\",\\\"OutputPath\\\":\\\"$.Payload\\\",\\\"Resource\\\":\\\"arn:\",{\"Ref\":\"AWS::Partition\"},\":states:::lambda:invoke\\\",\\\"Parameters\\\":{\\\"FunctionName\\\":\\\"\",{\"Fn::GetAtt\":[\"ClickStreamApiStackWorkflowStateMachineWorkflowFunctionD5F091A8\",\"Arn\"]},\"\\\",\\\"Payload.$\\\":\\\"$\\\"}},\\\"TypeChoice\\\":{\\\"Type\\\":\\\"Choice\\\",\\\"OutputPath\\\":\\\"$.Data\\\",\\\"Choices\\\":[{\\\"Variable\\\":\\\"$.Type\\\",\\\"StringEquals\\\":\\\"Stack\\\",\\\"Next\\\":\\\"StackExecution\\\"},{\\\"Variable\\\":\\\"$.Type\\\",\\\"StringEquals\\\":\\\"Serial\\\",\\\"Next\\\":\\\"SerialMap\\\"},{\\\"Variable\\\":\\\"$.Type\\\",\\\"StringEquals\\\":\\\"Parallel\\\",\\\"Next\\\":\\\"ParallelMap\\\"}],\\\"Default\\\":\\\"Pass\\\"},\\\"Pass\\\":{\\\"Type\\\":\\\"Pass\\\",\\\"End\\\":true},\\\"StackExecution\\\":{\\\"End\\\":true,\\\"Type\\\":\\\"Task\\\",\\\"Resource\\\":\\\"arn:\",{\"Ref\":\"AWS::Partition\"},\":states:::states:startExecution.sync:2\\\",\\\"Parameters\\\":{\\\"Input\\\":{\\\"Action.$\\\":\\\"$.Input.Action\\\",\\\"Token.$\\\":\\\"$$.Task.Token\\\",\\\"Input.$\\\":\\\"$.Input\\\",\\\"Callback.$\\\":\\\"$.Callback\\\"},\\\"StateMachineArn\\\":\\\"\",{\"Ref\":\"ClickStreamApiStackActionStateMachine21A0158C\"},\"\\\"}},\\\"SerialMap\\\":{\\\"Type\\\":\\\"Map\\\",\\\"End\\\":true,\\\"ItemsPath\\\":\\\"$\\\",\\\"ItemProcessor\\\":{\\\"ProcessorConfig\\\":{\\\"Mode\\\":\\\"INLINE\\\"},\\\"StartAt\\\":\\\"SerialCallSelf\\\",\\\"States\\\":{\\\"SerialCallSelf\\\":{\\\"End\\\":true,\\\"Type\\\":\\\"Task\\\",\\\"Resource\\\":\\\"arn:\",{\"Ref\":\"AWS::Partition\"},\":states:::states:startExecution.sync:2\\\",\\\"Parameters\\\":{\\\"Input\\\":{\\\"Token.$\\\":\\\"$$.Task.Token\\\",\\\"MapRun\\\":true,\\\"Data.$\\\":\\\"$\\\"},\\\"StateMachineArn\\\":\\\"arn:\",{\"Ref\":\"AWS::Partition\"},\":states:\",{\"Ref\":\"AWS::Region\"},\":\",{\"Ref\":\"AWS::AccountId\"},\":stateMachine:clickstream-stack-workflow-\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]},\"\\\"}}}},\\\"MaxConcurrency\\\":1},\\\"ParallelMap\\\":{\\\"Type\\\":\\\"Map\\\",\\\"End\\\":true,\\\"ItemsPath\\\":\\\"$\\\",\\\"ItemProcessor\\\":{\\\"ProcessorConfig\\\":{\\\"Mode\\\":\\\"INLINE\\\"},\\\"StartAt\\\":\\\"ParallelCallSelf\\\",\\\"States\\\":{\\\"ParallelCallSelf\\\":{\\\"End\\\":true,\\\"Type\\\":\\\"Task\\\",\\\"Resource\\\":\\\"arn:\",{\"Ref\":\"AWS::Partition\"},\":states:::states:startExecution.sync:2\\\",\\\"Parameters\\\":{\\\"Input\\\":{\\\"Token.$\\\":\\\"$$.Task.Token\\\",\\\"MapRun\\\":true,\\\"Data.$\\\":\\\"$\\\"},\\\"StateMachineArn\\\":\\\"arn:\",{\"Ref\":\"AWS::Partition\"},\":states:\",{\"Ref\":\"AWS::Region\"},\":\",{\"Ref\":\"AWS::AccountId\"},\":stateMachine:clickstream-stack-workflow-\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]},\"\\\"}}}},\\\"MaxConcurrency\\\":40}},\\\"TimeoutSeconds\\\":259200}\"]]},\"LoggingConfiguration\":{\"Destinations\":[{\"CloudWatchLogsLogGroup\":{\"LogGroupArn\":{\"Fn::GetAtt\":[\"ClickStreamApiStackWorkflowStateMachineLogGroup5A682818\",\"Arn\"]}}}],\"Level\":\"ALL\"},\"RoleArn\":{\"Fn::GetAtt\":[\"ClickStreamApiStackWorkflowStateMachineRoleFD8FA958\",\"Arn\"]},\"StateMachineName\":{\"Fn::Join\":[\"\",[\"clickstream-stack-workflow-\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]}]]},\"TracingConfiguration\":{\"Enabled\":true}},\"Type\":\"AWS::StepFunctions::StateMachine\",\"UpdateReplacePolicy\":\"Delete\"},\"ClickStreamApiStackWorkflowStateMachineLogGroup5A682818\":{\"DeletionPolicy\":\"Retain\",\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/StackWorkflowStateMachine/LogGroup/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W84\",\"reason\":\"Log group data is always encrypted in CloudWatch Logs. By default, CloudWatch Logs uses server-side encryption for the log data at rest.\"}]}},\"Properties\":{\"LogGroupName\":{\"Fn::Join\":[\"\",[\"/aws/vendedlogs/states/Clickstream/StackWorkflowLogGroup-\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]}]]}},\"Type\":\"AWS::Logs::LogGroup\",\"UpdateReplacePolicy\":\"Retain\"},\"ClickStreamApiStackWorkflowStateMachineRoleDefaultPolicyDCD707BA\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/StackWorkflowStateMachine/StackWorkflowStateMachine/Role/DefaultPolicy/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W12\",\"reason\":\"Policy is generated by DefaultPolicy, * states resources for read only access or IAM limitation.\"},{\"id\":\"W76\",\"reason\":\"Policy is generated by DefaultPolicy which resources SPCM for IAM policy document is higher than 25\"}]}},\"Properties\":{\"PolicyDocument\":{\"Statement\":[{\"Action\":\"lambda:InvokeFunction\",\"Effect\":\"Allow\",\"Resource\":[{\"Fn::GetAtt\":[\"ClickStreamApiStackWorkflowStateMachineWorkflowFunctionD5F091A8\",\"Arn\"]},{\"Fn::Join\":[\"\",[{\"Fn::GetAtt\":[\"ClickStreamApiStackWorkflowStateMachineWorkflowFunctionD5F091A8\",\"Arn\"]},\":*\"]]}]},{\"Action\":\"states:StartExecution\",\"Effect\":\"Allow\",\"Resource\":{\"Ref\":\"ClickStreamApiStackActionStateMachine21A0158C\"}},{\"Action\":[\"states:DescribeExecution\",\"states:StopExecution\"],\"Effect\":\"Allow\",\"Resource\":{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":states:\",{\"Ref\":\"AWS::Region\"},\":\",{\"Ref\":\"AWS::AccountId\"},\":execution:\",{\"Fn::Select\":[6,{\"Fn::Split\":[\":\",{\"Ref\":\"ClickStreamApiStackActionStateMachine21A0158C\"}]}]},\"*\"]]}},{\"Action\":[\"events:PutTargets\",\"events:PutRule\",\"events:DescribeRule\"],\"Effect\":\"Allow\",\"Resource\":{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":events:\",{\"Ref\":\"AWS::Region\"},\":\",{\"Ref\":\"AWS::AccountId\"},\":rule/StepFunctionsGetEventsForStepFunctionsExecutionRule\"]]}},{\"Action\":\"states:StartExecution\",\"Effect\":\"Allow\",\"Resource\":{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":states:\",{\"Ref\":\"AWS::Region\"},\":\",{\"Ref\":\"AWS::AccountId\"},\":stateMachine:clickstream-stack-workflow-\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]}]]}},{\"Action\":[\"states:DescribeExecution\",\"states:StopExecution\"],\"Effect\":\"Allow\",\"Resource\":{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":states:\",{\"Ref\":\"AWS::Region\"},\":\",{\"Ref\":\"AWS::AccountId\"},\":execution:clickstream-stack-workflow-\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]},\"*\"]]}},{\"Action\":[\"logs:CreateLogDelivery\",\"logs:GetLogDelivery\",\"logs:UpdateLogDelivery\",\"logs:DeleteLogDelivery\",\"logs:ListLogDeliveries\",\"logs:PutResourcePolicy\",\"logs:DescribeResourcePolicies\",\"logs:DescribeLogGroups\"],\"Effect\":\"Allow\",\"Resource\":\"*\"},{\"Action\":[\"xray:PutTraceSegments\",\"xray:PutTelemetryRecords\",\"xray:GetSamplingRules\",\"xray:GetSamplingTargets\"],\"Effect\":\"Allow\",\"Resource\":\"*\"}],\"Version\":\"2012-10-17\"},\"PolicyName\":\"ClickStreamApiStackWorkflowStateMachineRoleDefaultPolicyDCD707BA\",\"Roles\":[{\"Ref\":\"ClickStreamApiStackWorkflowStateMachineRoleFD8FA958\"}]},\"Type\":\"AWS::IAM::Policy\"},\"ClickStreamApiStackWorkflowStateMachineRoleFD8FA958\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/StackWorkflowStateMachine/StackWorkflowStateMachine/Role/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W28\",\"reason\":\"Set the role name with prefix\"}]}},\"Properties\":{\"AssumeRolePolicyDocument\":{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":{\"Fn::FindInMap\":[\"ServiceprincipalMap\",{\"Ref\":\"AWS::Region\"},\"states\"]}}}],\"Version\":\"2012-10-17\"},\"PermissionsBoundary\":{\"Fn::If\":[\"isEmptyPermissionBoundary\",{\"Ref\":\"AWS::NoValue\"},{\"Ref\":\"IamRoleBoundaryArn\"}]},\"RoleName\":{\"Fn::If\":[\"isEmptyRolePrefix\",{\"Ref\":\"AWS::NoValue\"},{\"Fn::Join\":[\"\",[{\"Ref\":\"IamRolePrefix\"},\"-lowStateMachineRole-\",{\"Ref\":\"AWS::Region\"},\"-\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]}]]}]}},\"Type\":\"AWS::IAM::Role\"},\"ClickStreamApiStackWorkflowStateMachineWorkflowFunctionD5F091A8\":{\"DependsOn\":[\"ClickStreamApiStackWorkflowStateMachineWorkflowFunctionRoleDefaultPolicyD3A5F5BE\",\"ClickStreamApiStackWorkflowStateMachineWorkflowFunctionRoleB4272C2D\"],\"Metadata\":{\"aws:asset:is-bundled\":true,\"aws:asset:path\":\"asset.175368919c871657136625f0f864647162a3c2cec9e3e0713799640b24b32e63\",\"aws:asset:property\":\"Code\",\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/StackWorkflowStateMachine/WorkflowFunction/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W89\",\"reason\":\"Lambda function is only used by portal_fn for deployment as cloudformation custom resources or per product design, no need to be deployed in VPC\"},{\"id\":\"W92\",\"reason\":\"Lambda function is only used by portal_fn for deployment as cloudformation custom resources or per product design, no need to set ReservedConcurrentExecutions\"}]}},\"Properties\":{\"Architectures\":[\"arm64\"],\"Code\":{\"S3Bucket\":{\"Fn::Sub\":\"solutions-${AWS::Region}\"},\"S3Key\":\"clickstream-analytics-on-aws/v1.1.11/175368919c871657136625f0f864647162a3c2cec9e3e0713799640b24b32e63.zip\"},\"Description\":\"Lambda function for state machine workflow of solution Clickstream Analytics on AWS\",\"Environment\":{\"Variables\":{\"AWS_NODEJS_CONNECTION_REUSE_ENABLED\":\"1\",\"LOG_LEVEL\":\"WARN\",\"POWERTOOLS_LOGGER_LOG_EVENT\":\"true\",\"POWERTOOLS_LOGGER_SAMPLE_RATE\":\"1\",\"POWERTOOLS_SERVICE_NAME\":\"ClickStreamAnalyticsOnAWS\",\"USER_AGENT_STRING\":\"AWSSOLUTION/SO0219/v1.1.11-202503111525\"}},\"Handler\":\"index.handler\",\"LoggingConfig\":{\"Fn::If\":[\"AWSCNCondition\",{\"Ref\":\"AWS::NoValue\"},{\"ApplicationLogLevel\":\"INFO\",\"LogFormat\":\"JSON\",\"LogGroup\":{\"Ref\":\"ClickStreamApiStackWorkflowStateMachineWorkflowFunctionlogF22A888E\"}}]},\"Role\":{\"Fn::GetAtt\":[\"ClickStreamApiStackWorkflowStateMachineWorkflowFunctionRoleB4272C2D\",\"Arn\"]},\"Runtime\":{\"Fn::If\":[\"AWSCNCondition\",\"nodejs18.x\",\"nodejs20.x\"]},\"Timeout\":15,\"TracingConfig\":{\"Mode\":\"Active\"}},\"Type\":\"AWS::Lambda::Function\"},\"ClickStreamApiStackWorkflowStateMachineWorkflowFunctionRoleB4272C2D\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/StackWorkflowStateMachine/WorkflowFunctionRole/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W28\",\"reason\":\"Set the role name with prefix\"}]}},\"Properties\":{\"AssumeRolePolicyDocument\":{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"lambda.amazonaws.com\"}}],\"Version\":\"2012-10-17\"},\"PermissionsBoundary\":{\"Fn::If\":[\"isEmptyPermissionBoundary\",{\"Ref\":\"AWS::NoValue\"},{\"Ref\":\"IamRoleBoundaryArn\"}]},\"RoleName\":{\"Fn::If\":[\"isEmptyRolePrefix\",{\"Ref\":\"AWS::NoValue\"},{\"Fn::Join\":[\"\",[{\"Ref\":\"IamRolePrefix\"},\"-orkflowFunctionRole-\",{\"Ref\":\"AWS::Region\"},\"-\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]}]]}]}},\"Type\":\"AWS::IAM::Role\"},\"ClickStreamApiStackWorkflowStateMachineWorkflowFunctionRoleDefaultPolicyD3A5F5BE\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/StackWorkflowStateMachine/WorkflowFunctionRole/DefaultPolicy/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W12\",\"reason\":\"The lambda service writes to undetermined logs stream by design\"}]}},\"Properties\":{\"PolicyDocument\":{\"Statement\":[{\"Action\":[\"logs:CreateLogStream\",\"logs:PutLogEvents\",\"logs:CreateLogGroup\"],\"Effect\":\"Allow\",\"Resource\":\"*\"},{\"Action\":\"cloudformation:DescribeStacks\",\"Effect\":\"Allow\",\"Resource\":{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":cloudformation:*:\",{\"Ref\":\"AWS::AccountId\"},\":stack/\",{\"Fn::If\":[\"IsEmptyRolePrefixCondition\",\"Clickstream\",{\"Fn::Join\":[\"\",[{\"Ref\":\"IamRolePrefix\"},\"-Clickstream\"]]}]},\"*\"]]}},{\"Action\":[\"xray:PutTraceSegments\",\"xray:PutTelemetryRecords\"],\"Effect\":\"Allow\",\"Resource\":\"*\"},{\"Action\":[\"s3:GetObject*\",\"s3:GetBucket*\",\"s3:List*\",\"s3:DeleteObject*\",\"s3:PutObject\",\"s3:PutObjectLegalHold\",\"s3:PutObjectRetention\",\"s3:PutObjectTagging\",\"s3:PutObjectVersionTagging\",\"s3:Abort*\"],\"Effect\":\"Allow\",\"Resource\":[{\"Fn::GetAtt\":[\"ClickstreamSolutionDataBucket200465FE\",\"Arn\"]},{\"Fn::Join\":[\"\",[{\"Fn::GetAtt\":[\"ClickstreamSolutionDataBucket200465FE\",\"Arn\"]},\"/clickstream/*\"]]}]}],\"Version\":\"2012-10-17\"},\"PolicyName\":\"ClickStreamApiStackWorkflowStateMachineWorkflowFunctionRoleDefaultPolicyD3A5F5BE\",\"Roles\":[{\"Ref\":\"ClickStreamApiStackWorkflowStateMachineWorkflowFunctionRoleB4272C2D\"}]},\"Type\":\"AWS::IAM::Policy\"},\"ClickStreamApiStackWorkflowStateMachineWorkflowFunctionlogF22A888E\":{\"DeletionPolicy\":\"Delete\",\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/StackWorkflowStateMachine/WorkflowFunction-log/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W84\",\"reason\":\"Log group data is always encrypted in CloudWatch Logs. By default, CloudWatch Logs uses server-side encryption for the log data at rest.\"}]}},\"Properties\":{\"LogGroupClass\":\"STANDARD\"},\"Type\":\"AWS::Logs::LogGroup\",\"UpdateReplacePolicy\":\"Delete\"},\"ClickStreamApiUploadRole7BE99918\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/UploadRole/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W28\",\"reason\":\"Set the role name with prefix\"}]}},\"Properties\":{\"AssumeRolePolicyDocument\":{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"AWS\":{\"Fn::GetAtt\":[\"ClickStreamApiApiFunctionRole378A2758\",\"Arn\"]}}}],\"Version\":\"2012-10-17\"},\"PermissionsBoundary\":{\"Fn::If\":[\"isEmptyPermissionBoundary\",{\"Ref\":\"AWS::NoValue\"},{\"Ref\":\"IamRoleBoundaryArn\"}]},\"RoleName\":{\"Fn::If\":[\"isEmptyRolePrefix\",{\"Ref\":\"AWS::NoValue\"},{\"Fn::Join\":[\"\",[{\"Ref\":\"IamRolePrefix\"},\"-UploadRole-\",{\"Ref\":\"AWS::Region\"},\"-\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]}]]}]}},\"Type\":\"AWS::IAM::Role\"},\"ClickStreamApiUploadRoleDefaultPolicyE2E4FB33\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/UploadRole/DefaultPolicy/Resource\"},\"Properties\":{\"PolicyDocument\":{\"Statement\":[{\"Action\":[\"s3:PutObject\",\"s3:PutObjectLegalHold\",\"s3:PutObjectRetention\",\"s3:PutObjectTagging\",\"s3:PutObjectVersionTagging\",\"s3:Abort*\"],\"Effect\":\"Allow\",\"Resource\":{\"Fn::Join\":[\"\",[{\"Fn::GetAtt\":[\"ClickstreamSolutionDataBucket200465FE\",\"Arn\"]},\"/plugins/*\"]]}}],\"Version\":\"2012-10-17\"},\"PolicyName\":\"ClickStreamApiUploadRoleDefaultPolicyE2E4FB33\",\"Roles\":[{\"Ref\":\"ClickStreamApiUploadRole7BE99918\"}]},\"Type\":\"AWS::IAM::Policy\"},\"ClickStreamApiproxyANY2008788F\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/ClickStreamApi/Default/{proxy+}/ANY/Resource\"},\"Properties\":{\"AuthorizationType\":\"CUSTOM\",\"AuthorizerId\":{\"Ref\":\"JWTAuthorizerE8D8D90E\"},\"HttpMethod\":\"ANY\",\"Integration\":{\"IntegrationHttpMethod\":\"POST\",\"Type\":\"AWS_PROXY\",\"Uri\":{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":apigateway:\",{\"Ref\":\"AWS::Region\"},\":lambda:path/2015-03-31/functions/\",{\"Fn::GetAtt\":[\"ClickStreamApiApiFunction684A4D61\",\"Arn\"]},\"/invocations\"]]}},\"ResourceId\":{\"Ref\":\"ClickStreamApiproxyC314E806\"},\"RestApiId\":{\"Ref\":\"ClickStreamApi748490D9\"}},\"Type\":\"AWS::ApiGateway::Method\"},\"ClickStreamApiproxyANYApiPermissionTestcloudfronts3controlplanestackglobalClickStreamApiFB563409ANYproxy93DB539B\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/ClickStreamApi/Default/{proxy+}/ANY/ApiPermission.Test.cloudfronts3controlplanestackglobalClickStreamApiFB563409.ANY..{proxy+}\"},\"Properties\":{\"Action\":\"lambda:InvokeFunction\",\"FunctionName\":{\"Fn::GetAtt\":[\"ClickStreamApiApiFunction684A4D61\",\"Arn\"]},\"Principal\":\"apigateway.amazonaws.com\",\"SourceArn\":{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":execute-api:\",{\"Ref\":\"AWS::Region\"},\":\",{\"Ref\":\"AWS::AccountId\"},\":\",{\"Ref\":\"ClickStreamApi748490D9\"},\"/test-invoke-stage/*/*\"]]}},\"Type\":\"AWS::Lambda::Permission\"},\"ClickStreamApiproxyANYApiPermissioncloudfronts3controlplanestackglobalClickStreamApiFB563409ANYproxyB6BDB120\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/ClickStreamApi/Default/{proxy+}/ANY/ApiPermission.cloudfronts3controlplanestackglobalClickStreamApiFB563409.ANY..{proxy+}\"},\"Properties\":{\"Action\":\"lambda:InvokeFunction\",\"FunctionName\":{\"Fn::GetAtt\":[\"ClickStreamApiApiFunction684A4D61\",\"Arn\"]},\"Principal\":\"apigateway.amazonaws.com\",\"SourceArn\":{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":execute-api:\",{\"Ref\":\"AWS::Region\"},\":\",{\"Ref\":\"AWS::AccountId\"},\":\",{\"Ref\":\"ClickStreamApi748490D9\"},\"/\",{\"Ref\":\"ClickStreamApiDeploymentStageapi40499B1B\"},\"/*/*\"]]}},\"Type\":\"AWS::Lambda::Permission\"},\"ClickStreamApiproxyC314E806\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickStreamApi/ClickStreamApi/Default/{proxy+}/Resource\"},\"Properties\":{\"ParentId\":{\"Fn::GetAtt\":[\"ClickStreamApi748490D9\",\"RootResourceId\"]},\"PathPart\":\"{proxy+}\",\"RestApiId\":{\"Ref\":\"ClickStreamApi748490D9\"}},\"Type\":\"AWS::ApiGateway::Resource\"},\"ClickstreamSolutionDataBucket200465FE\":{\"DeletionPolicy\":\"Retain\",\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickstreamSolution/DataBucket/Resource\"},\"Properties\":{\"AccessControl\":\"LogDeliveryWrite\",\"BucketEncryption\":{\"ServerSideEncryptionConfiguration\":[{\"ServerSideEncryptionByDefault\":{\"SSEAlgorithm\":\"AES256\"}}]},\"CorsConfiguration\":{\"CorsRules\":[{\"AllowedHeaders\":[\"*\"],\"AllowedMethods\":[\"PUT\",\"POST\",\"GET\"],\"AllowedOrigins\":[\"*\"],\"ExposedHeaders\":[\"x-amz-server-side-encryption\",\"x-amz-request-id\",\"x-amz-id-2\",\"ETag\"],\"MaxAge\":3000}]},\"LoggingConfiguration\":{\"LogFilePrefix\":\"data-bucket-access-logs\"},\"OwnershipControls\":{\"Rules\":[{\"ObjectOwnership\":\"ObjectWriter\"}]},\"PublicAccessBlockConfiguration\":{\"BlockPublicAcls\":true,\"BlockPublicPolicy\":true,\"IgnorePublicAcls\":true,\"RestrictPublicBuckets\":true}},\"Type\":\"AWS::S3::Bucket\",\"UpdateReplacePolicy\":\"Retain\"},\"ClickstreamSolutionDataBucketPolicy05271F62\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/ClickstreamSolution/DataBucket/Policy/Resource\"},\"Properties\":{\"Bucket\":{\"Ref\":\"ClickstreamSolutionDataBucket200465FE\"},\"PolicyDocument\":{\"Statement\":[{\"Action\":\"s3:*\",\"Condition\":{\"Bool\":{\"aws:SecureTransport\":\"false\"}},\"Effect\":\"Deny\",\"Principal\":{\"AWS\":\"*\"},\"Resource\":[{\"Fn::GetAtt\":[\"ClickstreamSolutionDataBucket200465FE\",\"Arn\"]},{\"Fn::Join\":[\"\",[{\"Fn::GetAtt\":[\"ClickstreamSolutionDataBucket200465FE\",\"Arn\"]},\"/*\"]]}]}],\"Version\":\"2012-10-17\"}},\"Type\":\"AWS::S3::BucketPolicy\"},\"CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C81C01536\":{\"DependsOn\":[\"CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRoleDefaultPolicy88902FDF\",\"CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265\"],\"Metadata\":{\"aws:asset:is-bundled\":false,\"aws:asset:path\":\"asset.2d56e153cac88d3e0c2f842e8e6f6783b8725bf91f95e0673b4725448a56e96d\",\"aws:asset:property\":\"Code\",\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W89\",\"reason\":\"Lambda function is only used by CDK built-in BucketDeployment for deployment as cloudformation custom resources or per product design, no need to be deployed in VPC\"},{\"id\":\"W92\",\"reason\":\"Lambda function is only used by CDK built-in BucketDeployment for deployment as cloudformation custom resources or per product design, no need to set ReservedConcurrentExecutions\"}]}},\"Properties\":{\"Code\":{\"S3Bucket\":{\"Fn::Sub\":\"solutions-${AWS::Region}\"},\"S3Key\":\"clickstream-analytics-on-aws/v1.1.11/2d56e153cac88d3e0c2f842e8e6f6783b8725bf91f95e0673b4725448a56e96d.zip\"},\"Environment\":{\"Variables\":{\"AWS_CA_BUNDLE\":\"/etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem\",\"USER_AGENT_STRING\":\"AWSSOLUTION/SO0219/v1.1.11-202503111525\"}},\"Handler\":\"index.handler\",\"Layers\":[{\"Ref\":\"cloudfrontcontrolplaneportaldeployAwsCliLayerE6343FE0\"}],\"Role\":{\"Fn::GetAtt\":[\"CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265\",\"Arn\"]},\"Runtime\":\"python3.9\",\"Timeout\":900},\"Type\":\"AWS::Lambda::Function\"},\"CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C/ServiceRole/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W28\",\"reason\":\"Set the role name with prefix\"}]}},\"Properties\":{\"AssumeRolePolicyDocument\":{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"lambda.amazonaws.com\"}}],\"Version\":\"2012-10-17\"},\"ManagedPolicyArns\":[{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\"]]}],\"PermissionsBoundary\":{\"Fn::If\":[\"isEmptyPermissionBoundary\",{\"Ref\":\"AWS::NoValue\"},{\"Ref\":\"IamRoleBoundaryArn\"}]},\"RoleName\":{\"Fn::If\":[\"isEmptyRolePrefix\",{\"Ref\":\"AWS::NoValue\"},{\"Fn::Join\":[\"\",[{\"Ref\":\"IamRolePrefix\"},\"-9EB8756CServiceRole-\",{\"Ref\":\"AWS::Region\"},\"-\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]}]]}]}},\"Type\":\"AWS::IAM::Role\"},\"CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRoleDefaultPolicy88902FDF\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C/ServiceRole/DefaultPolicy/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W12\",\"reason\":\"Policy is generated by CDK built-in BucketDeployment, * cloudFront resources for read only access or IAM limitation.\"}]}},\"Properties\":{\"PolicyDocument\":{\"Statement\":[{\"Action\":[\"s3:GetObject*\",\"s3:GetBucket*\",\"s3:List*\"],\"Effect\":\"Allow\",\"Resource\":[{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":s3:::\",{\"Fn::Sub\":\"solutions-${AWS::Region}\"}]]},{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":s3:::\",{\"Fn::Sub\":\"solutions-${AWS::Region}\"},\"/*\"]]}]},{\"Action\":[\"s3:GetObject*\",\"s3:GetBucket*\",\"s3:List*\",\"s3:DeleteObject*\",\"s3:PutObject\",\"s3:PutObjectLegalHold\",\"s3:PutObjectRetention\",\"s3:PutObjectTagging\",\"s3:PutObjectVersionTagging\",\"s3:Abort*\"],\"Effect\":\"Allow\",\"Resource\":[{\"Fn::GetAtt\":[\"cloudfrontcontrolplaneportalbucket1534502E\",\"Arn\"]},{\"Fn::Join\":[\"\",[{\"Fn::GetAtt\":[\"cloudfrontcontrolplaneportalbucket1534502E\",\"Arn\"]},\"/*\"]]}]},{\"Action\":[\"cloudfront:GetInvalidation\",\"cloudfront:CreateInvalidation\"],\"Effect\":\"Allow\",\"Resource\":\"*\"}],\"Version\":\"2012-10-17\"},\"PolicyName\":\"CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRoleDefaultPolicy88902FDF\",\"Roles\":[{\"Ref\":\"CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265\"}]},\"Type\":\"AWS::IAM::Policy\"},\"CustomS3AutoDeleteObjectsCustomResourceProviderHandler9D90184F\":{\"DependsOn\":[\"CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092\"],\"Metadata\":{\"aws:asset:path\":\"asset.2eb6a831b107939f63cfebf68e6316e1a40f79fc99cae0fee9b333bac8d29bc4\",\"aws:asset:property\":\"Code\",\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/Custom::S3AutoDeleteObjectsCustomResourceProvider/Handler\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W89\",\"reason\":\"Lambda function is only used by S3AutoDeleteObjects for deployment as cloudformation custom resources or per product design, no need to be deployed in VPC\"},{\"id\":\"W92\",\"reason\":\"Lambda function is only used by S3AutoDeleteObjects for deployment as cloudformation custom resources or per product design, no need to set ReservedConcurrentExecutions\"}]}},\"Properties\":{\"Code\":{\"S3Bucket\":{\"Fn::Sub\":\"solutions-${AWS::Region}\"},\"S3Key\":\"clickstream-analytics-on-aws/v1.1.11/2eb6a831b107939f63cfebf68e6316e1a40f79fc99cae0fee9b333bac8d29bc4.zip\"},\"Description\":{\"Fn::Join\":[\"\",[\"Lambda function for auto-deleting objects in \",{\"Ref\":\"cloudfrontcontrolplaneportalbucket1534502E\"},\" S3 bucket.\"]]},\"Handler\":\"index.handler\",\"MemorySize\":128,\"Role\":{\"Fn::GetAtt\":[\"CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092\",\"Arn\"]},\"Runtime\":\"nodejs18.x\",\"Timeout\":900},\"Type\":\"AWS::Lambda::Function\"},\"CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/Custom::S3AutoDeleteObjectsCustomResourceProvider/Role\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W28\",\"reason\":\"Set the role name with prefix\"}]}},\"Properties\":{\"AssumeRolePolicyDocument\":{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"lambda.amazonaws.com\"}}],\"Version\":\"2012-10-17\"},\"ManagedPolicyArns\":[{\"Fn::Sub\":\"arn:${AWS::Partition}:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\"}],\"PermissionsBoundary\":{\"Fn::If\":[\"isEmptyPermissionBoundary\",{\"Ref\":\"AWS::NoValue\"},{\"Ref\":\"IamRoleBoundaryArn\"}]},\"RoleName\":{\"Fn::If\":[\"isEmptyRolePrefix\",{\"Ref\":\"AWS::NoValue\"},{\"Fn::Join\":[\"\",[{\"Ref\":\"IamRolePrefix\"},\"-esourceProviderRole-\",{\"Ref\":\"AWS::Region\"},\"-\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]}]]}]}},\"Type\":\"AWS::IAM::Role\"},\"FrontRewriteFunction560E1714\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/FrontRewriteFunction/Resource\"},\"Properties\":{\"AutoPublish\":true,\"FunctionCode\":\"function handler(event) {\\n  var request = event.request;\\n  var uri = request.uri;\\n  if (uri.startsWith('/signin') || \\n    uri.startsWith('/projects') || \\n    uri.startsWith('/project') || \\n    uri.startsWith('/pipelines') || \\n    uri.startsWith('/plugins') || \\n    uri.startsWith('/alarms') || \\n    uri.startsWith('/user') || \\n    uri.startsWith('/analytics') || \\n    uri.startsWith('/quicksight')) {\\n      request.uri = '/index.html'; \\n  }\\n  return request; \\n}\",\"FunctionConfig\":{\"Comment\":{\"Fn::Join\":[\"\",[\"FrontRewriteFunction-\",{\"Ref\":\"AWS::Region\"},\"-\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]}]]},\"Runtime\":\"cloudfront-js-1.0\"},\"Name\":{\"Fn::Join\":[\"\",[\"FrontRewriteFunction-\",{\"Ref\":\"AWS::Region\"},\"-\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]}]]}},\"Type\":\"AWS::CloudFront::Function\"},\"JWTAuthorizerE8D8D90E\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/JWTAuthorizer/Resource\"},\"Properties\":{\"AuthorizerResultTtlInSeconds\":0,\"AuthorizerUri\":{\"Fn::Join\":[\"\",[\"arn:\",{\"Fn::Select\":[1,{\"Fn::Split\":[\":\",{\"Fn::GetAtt\":[\"AuthorizerFunctionB4DBAA43\",\"Arn\"]}]}]},\":apigateway:\",{\"Fn::Select\":[3,{\"Fn::Split\":[\":\",{\"Fn::GetAtt\":[\"AuthorizerFunctionB4DBAA43\",\"Arn\"]}]}]},\":lambda:path/2015-03-31/functions/\",{\"Fn::GetAtt\":[\"AuthorizerFunctionB4DBAA43\",\"Arn\"]},\"/invocations\"]]},\"IdentitySource\":\"method.request.header.Authorization\",\"IdentityValidationExpression\":\"^(Bearer )[a-zA-Z0-9-_]+?.[a-zA-Z0-9-_]+?.([a-zA-Z0-9-_]+)$\",\"Name\":\"cloudfronts3controlplanestackglobalJWTAuthorizer35A98B82\",\"RestApiId\":{\"Ref\":\"ClickStreamApi748490D9\"},\"Type\":\"TOKEN\"},\"Type\":\"AWS::ApiGateway::Authorizer\"},\"backenduser\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/backend-user\"},\"Properties\":{\"UserAttributes\":[{\"Name\":\"email\",\"Value\":{\"Ref\":\"Email\"}}],\"UserPoolId\":{\"Ref\":\"userPoolDC9497E0\"},\"Username\":{\"Ref\":\"Email\"}},\"Type\":\"AWS::Cognito::UserPoolUser\"},\"clickstreambackendclient721D6562\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/clickstream-backend-client/Resource\"},\"Properties\":{\"AllowedOAuthFlows\":[\"implicit\",\"code\"],\"AllowedOAuthFlowsUserPoolClient\":true,\"AllowedOAuthScopes\":[\"openid\",\"email\",\"profile\"],\"CallbackURLs\":[{\"Fn::Join\":[\"\",[\"https://\",{\"Fn::GetAtt\":[\"cloudfrontcontrolplanePortalDistributionCAE911E8\",\"DomainName\"]},\"/signin\"]]}],\"LogoutURLs\":[{\"Fn::Join\":[\"\",[\"https://\",{\"Fn::GetAtt\":[\"cloudfrontcontrolplanePortalDistributionCAE911E8\",\"DomainName\"]}]]}],\"PreventUserExistenceErrors\":\"ENABLED\",\"SupportedIdentityProviders\":[\"COGNITO\"],\"UserPoolId\":{\"Ref\":\"userPoolDC9497E0\"}},\"Type\":\"AWS::Cognito::UserPoolClient\"},\"cloudfrontcontrolplanePortalDistributionCAE911E8\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/cloudfront_control_plane/PortalDistribution/Resource\",\"cfn_nag\":{\"rules_to_suppress\":[{\"id\":\"W70\",\"reason\":\"suppress minium TLSv1.2 warning when using default certificate/domain name of cloudfront\"}]}},\"Properties\":{\"DistributionConfig\":{\"Aliases\":[],\"CacheBehaviors\":[{\"AllowedMethods\":[\"GET\",\"HEAD\",\"OPTIONS\",\"PUT\",\"PATCH\",\"POST\",\"DELETE\"],\"CachePolicyId\":\"4135ea2d-6df8-44a3-9df3-4b5a84be39ad\",\"Compress\":true,\"OriginRequestPolicyId\":{\"Ref\":\"ApiGatewayOriginRequestPolicy339DF282\"},\"PathPattern\":{\"Fn::Join\":[\"\",[\"/\",{\"Ref\":\"ClickStreamApiDeploymentStageapi40499B1B\"},\"/*\"]]},\"TargetOriginId\":\"cloudfronts3controlplanestackglobalcloudfrontcontrolplanePortalDistributionOrigin249EB2591\",\"ViewerProtocolPolicy\":\"redirect-to-https\"}],\"Comment\":\"CloudFront distribution for (SO0219) Clickstream Analytics on AWS (Version v1.1.11)(Build 202503111525)- Control Plane\",\"DefaultCacheBehavior\":{\"AllowedMethods\":[\"GET\",\"HEAD\"],\"CachePolicyId\":{\"Ref\":\"cloudfrontcontrolplanedefaultCachePolicy7107D442\"},\"CachedMethods\":[\"GET\",\"HEAD\"],\"Compress\":true,\"FunctionAssociations\":[{\"EventType\":\"viewer-request\",\"FunctionARN\":{\"Fn::GetAtt\":[\"FrontRewriteFunction560E1714\",\"FunctionARN\"]}}],\"ResponseHeadersPolicyId\":{\"Ref\":\"responseheaderspolicy35100ADE\"},\"TargetOriginId\":\"cloudfronts3controlplanestackglobalcloudfrontcontrolplanePortalDistributionOrigin128533401\",\"ViewerProtocolPolicy\":\"redirect-to-https\"},\"DefaultRootObject\":\"index.html\",\"Enabled\":true,\"HttpVersion\":\"http2and3\",\"IPV6Enabled\":false,\"Logging\":{\"Fn::If\":[\"cloudfrontcontrolplanenotOpsInRegionFA8E79C7\",{\"Bucket\":{\"Fn::GetAtt\":[\"ClickstreamSolutionDataBucket200465FE\",\"RegionalDomainName\"]},\"Prefix\":\"cloudfront-access-log\"},{\"Ref\":\"AWS::NoValue\"}]},\"Origins\":[{\"DomainName\":{\"Fn::GetAtt\":[\"cloudfrontcontrolplaneportalbucket1534502E\",\"RegionalDomainName\"]},\"Id\":\"cloudfronts3controlplanestackglobalcloudfrontcontrolplanePortalDistributionOrigin128533401\",\"OriginAccessControlId\":{\"Fn::GetAtt\":[\"cloudfrontcontrolplaneoriginaccesscontrol66E2793E\",\"Id\"]},\"S3OriginConfig\":{\"OriginAccessIdentity\":\"\"}},{\"CustomOriginConfig\":{\"OriginProtocolPolicy\":\"https-only\",\"OriginSSLProtocols\":[\"TLSv1.2\"]},\"DomainName\":{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Fn::Join\":[\"\",[\"https://\",{\"Ref\":\"ClickStreamApi748490D9\"},\".execute-api.\",{\"Ref\":\"AWS::Region\"},\".\",{\"Ref\":\"AWS::URLSuffix\"},\"/\",{\"Ref\":\"ClickStreamApiDeploymentStageapi40499B1B\"},\"/\"]]}]}]},\"Id\":\"cloudfronts3controlplanestackglobalcloudfrontcontrolplanePortalDistributionOrigin249EB2591\",\"OriginPath\":{\"Fn::Join\":[\"\",[\"/\",{\"Ref\":\"ClickStreamApiDeploymentStageapi40499B1B\"}]]}}],\"PriceClass\":\"PriceClass_200\"}},\"Type\":\"AWS::CloudFront::Distribution\"},\"cloudfrontcontrolplanePortalDistributionOrigin1S3Origin79E734AC\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/cloudfront_control_plane/PortalDistribution/Origin1/S3Origin/Resource\"},\"Properties\":{\"CloudFrontOriginAccessIdentityConfig\":{\"Comment\":\"Identity for cloudfronts3controlplanestackglobalcloudfrontcontrolplanePortalDistributionOrigin128533401\"}},\"Type\":\"AWS::CloudFront::CloudFrontOriginAccessIdentity\"},\"cloudfrontcontrolplanedefaultCachePolicy7107D442\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/cloudfront_control_plane/defaultCachePolicy/Resource\"},\"Properties\":{\"CachePolicyConfig\":{\"DefaultTTL\":604800,\"MaxTTL\":2592000,\"MinTTL\":0,\"Name\":{\"Fn::Join\":[\"\",[\"cachepolicy-\",{\"Ref\":\"AWS::Region\"},\"-\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]}]]},\"ParametersInCacheKeyAndForwardedToOrigin\":{\"CookiesConfig\":{\"CookieBehavior\":\"none\"},\"EnableAcceptEncodingBrotli\":false,\"EnableAcceptEncodingGzip\":false,\"HeadersConfig\":{\"HeaderBehavior\":\"none\"},\"QueryStringsConfig\":{\"QueryStringBehavior\":\"none\"}}}},\"Type\":\"AWS::CloudFront::CachePolicy\"},\"cloudfrontcontrolplaneoriginaccesscontrol66E2793E\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/cloudfront_control_plane/origin_access_control\"},\"Properties\":{\"OriginAccessControlConfig\":{\"Name\":{\"Fn::Join\":[\"\",[\"clickstream-controlplane-oac-\",{\"Ref\":\"AWS::Region\"},\"-\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]}]]},\"OriginAccessControlOriginType\":\"s3\",\"SigningBehavior\":\"always\",\"SigningProtocol\":\"sigv4\"}},\"Type\":\"AWS::CloudFront::OriginAccessControl\"},\"cloudfrontcontrolplaneportalbucket1534502E\":{\"DeletionPolicy\":\"Delete\",\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/cloudfront_control_plane/portal_bucket/Resource\"},\"Properties\":{\"AccessControl\":\"LogDeliveryWrite\",\"BucketEncryption\":{\"ServerSideEncryptionConfiguration\":[{\"ServerSideEncryptionByDefault\":{\"SSEAlgorithm\":\"AES256\"}}]},\"LoggingConfiguration\":{\"DestinationBucketName\":{\"Ref\":\"ClickstreamSolutionDataBucket200465FE\"},\"LogFilePrefix\":\"portal-bucket-access-log/\"},\"OwnershipControls\":{\"Rules\":[{\"ObjectOwnership\":\"ObjectWriter\"}]},\"PublicAccessBlockConfiguration\":{\"BlockPublicAcls\":true,\"BlockPublicPolicy\":true,\"IgnorePublicAcls\":true,\"RestrictPublicBuckets\":true},\"Tags\":[{\"Key\":\"aws-cdk:auto-delete-objects\",\"Value\":\"true\"},{\"Key\":\"aws-cdk:cr-owned:2ba3118a\",\"Value\":\"true\"},{\"Key\":\"aws-cdk:cr-owned:9a343ac8\",\"Value\":\"true\"}]},\"Type\":\"AWS::S3::Bucket\",\"UpdateReplacePolicy\":\"Delete\"},\"cloudfrontcontrolplaneportalbucketAutoDeleteObjectsCustomResource43E2DB9D\":{\"DeletionPolicy\":\"Delete\",\"DependsOn\":[\"cloudfrontcontrolplaneportalbucketPolicy525DAD23\"],\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/cloudfront_control_plane/portal_bucket/AutoDeleteObjectsCustomResource/Default\"},\"Properties\":{\"BucketName\":{\"Ref\":\"cloudfrontcontrolplaneportalbucket1534502E\"},\"ServiceToken\":{\"Fn::GetAtt\":[\"CustomS3AutoDeleteObjectsCustomResourceProviderHandler9D90184F\",\"Arn\"]}},\"Type\":\"Custom::S3AutoDeleteObjects\",\"UpdateReplacePolicy\":\"Delete\"},\"cloudfrontcontrolplaneportalbucketPolicy525DAD23\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/cloudfront_control_plane/portal_bucket/Policy/Resource\"},\"Properties\":{\"Bucket\":{\"Ref\":\"cloudfrontcontrolplaneportalbucket1534502E\"},\"PolicyDocument\":{\"Statement\":[{\"Action\":\"s3:*\",\"Condition\":{\"Bool\":{\"aws:SecureTransport\":\"false\"}},\"Effect\":\"Deny\",\"Principal\":{\"AWS\":\"*\"},\"Resource\":[{\"Fn::GetAtt\":[\"cloudfrontcontrolplaneportalbucket1534502E\",\"Arn\"]},{\"Fn::Join\":[\"\",[{\"Fn::GetAtt\":[\"cloudfrontcontrolplaneportalbucket1534502E\",\"Arn\"]},\"/*\"]]}]},{\"Action\":[\"s3:PutBucketPolicy\",\"s3:GetBucket*\",\"s3:List*\",\"s3:DeleteObject*\"],\"Effect\":\"Allow\",\"Principal\":{\"AWS\":{\"Fn::GetAtt\":[\"CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092\",\"Arn\"]}},\"Resource\":[{\"Fn::GetAtt\":[\"cloudfrontcontrolplaneportalbucket1534502E\",\"Arn\"]},{\"Fn::Join\":[\"\",[{\"Fn::GetAtt\":[\"cloudfrontcontrolplaneportalbucket1534502E\",\"Arn\"]},\"/*\"]]}]},{\"Action\":\"s3:GetObject\",\"Effect\":\"Allow\",\"Principal\":{\"CanonicalUser\":{\"Fn::GetAtt\":[\"cloudfrontcontrolplanePortalDistributionOrigin1S3Origin79E734AC\",\"S3CanonicalUserId\"]}},\"Resource\":{\"Fn::Join\":[\"\",[{\"Fn::GetAtt\":[\"cloudfrontcontrolplaneportalbucket1534502E\",\"Arn\"]},\"/*\"]]}},{\"Action\":\"s3:GetObject\",\"Condition\":{\"StringEquals\":{\"AWS:SourceArn\":{\"Fn::Join\":[\"\",[\"arn:\",{\"Ref\":\"AWS::Partition\"},\":cloudfront::\",{\"Ref\":\"AWS::AccountId\"},\":distribution/\",{\"Ref\":\"cloudfrontcontrolplanePortalDistributionCAE911E8\"}]]}}},\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"cloudfront.amazonaws.com\"},\"Resource\":{\"Fn::Join\":[\"\",[{\"Fn::GetAtt\":[\"cloudfrontcontrolplaneportalbucket1534502E\",\"Arn\"]},\"/*\"]]}}],\"Version\":\"2012-10-17\"}},\"Type\":\"AWS::S3::BucketPolicy\"},\"cloudfrontcontrolplaneportaldeployAwsCliLayerE6343FE0\":{\"Metadata\":{\"aws:asset:is-bundled\":false,\"aws:asset:path\":\"asset.1c5a2ab1d1e53b0672a644454aab3dbb258ccd0079c92ad0e23b95b2c2079f70.zip\",\"aws:asset:property\":\"Content\",\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/cloudfront_control_plane/portal_deploy/AwsCliLayer/Resource\"},\"Properties\":{\"Content\":{\"S3Bucket\":{\"Fn::Sub\":\"solutions-${AWS::Region}\"},\"S3Key\":\"clickstream-analytics-on-aws/v1.1.11/1c5a2ab1d1e53b0672a644454aab3dbb258ccd0079c92ad0e23b95b2c2079f70.zip\"},\"Description\":\"/opt/awscli/aws\"},\"Type\":\"AWS::Lambda::LayerVersion\"},\"cloudfrontcontrolplaneportaldeployCustomResource3FBC8A44\":{\"DeletionPolicy\":\"Delete\",\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/cloudfront_control_plane/portal_deploy/CustomResource/Default\"},\"Properties\":{\"DestinationBucketName\":{\"Ref\":\"cloudfrontcontrolplaneportalbucket1534502E\"},\"DistributionId\":{\"Ref\":\"cloudfrontcontrolplanePortalDistributionCAE911E8\"},\"DistributionPaths\":[\"/index.html\",\"/asset-manifest.json\",\"/robots.txt\",\"/aws-exports.json\",\"/locales/*\"],\"Prune\":false,\"ServiceToken\":{\"Fn::GetAtt\":[\"CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C81C01536\",\"Arn\"]},\"SourceBucketNames\":[{\"Fn::Sub\":\"solutions-${AWS::Region}\"},{\"Fn::Sub\":\"solutions-${AWS::Region}\"}],\"SourceMarkers\":[{},{\"\\u003c\\u003cmarker:0xbaba:0\\u003e\\u003e\":{\"Ref\":\"AWS::Region\"},\"\\u003c\\u003cmarker:0xbaba:1\\u003e\\u003e\":{\"Ref\":\"userPoolDC9497E0\"},\"\\u003c\\u003cmarker:0xbaba:2\\u003e\\u003e\":{\"Ref\":\"clickstreambackendclient721D6562\"},\"\\u003c\\u003cmarker:0xbaba:3\\u003e\\u003e\":{\"Fn::GetAtt\":[\"cloudfrontcontrolplanePortalDistributionCAE911E8\",\"DomainName\"]},\"\\u003c\\u003cmarker:0xbaba:4\\u003e\\u003e\":{\"Ref\":\"ClickstreamSolutionDataBucket200465FE\"},\"\\u003c\\u003cmarker:0xbaba:5\\u003e\\u003e\":{\"Ref\":\"AWS::Region\"},\"\\u003c\\u003cmarker:0xbaba:6\\u003e\\u003e\":{\"Ref\":\"userPoolcognitodomain5F5914A6\"},\"\\u003c\\u003cmarker:0xbaba:7\\u003e\\u003e\":{\"Ref\":\"AWS::Region\"}}],\"SourceObjectKeys\":[\"clickstream-analytics-on-aws/v1.1.11/2a17c9ab496c54a2996226c80931a0bc5650dd838720fd15ee84c7907cbfa676.zip\",\"clickstream-analytics-on-aws/v1.1.11/e9fe8353e7ae2f315236eadfa4e7b5977b54be08640cf31743ae870842259eef.zip\"],\"SystemMetadata\":{\"cache-control\":\"max-age=2592000, immutable\"}},\"Type\":\"Custom::CDKBucketDeployment\",\"UpdateReplacePolicy\":\"Delete\"},\"cloudfrontcontrolplaneportalhtmldeployAwsCliLayerAC9CB96A\":{\"Metadata\":{\"aws:asset:is-bundled\":false,\"aws:asset:path\":\"asset.1c5a2ab1d1e53b0672a644454aab3dbb258ccd0079c92ad0e23b95b2c2079f70.zip\",\"aws:asset:property\":\"Content\",\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/cloudfront_control_plane/portal_html_deploy/AwsCliLayer/Resource\"},\"Properties\":{\"Content\":{\"S3Bucket\":{\"Fn::Sub\":\"solutions-${AWS::Region}\"},\"S3Key\":\"clickstream-analytics-on-aws/v1.1.11/1c5a2ab1d1e53b0672a644454aab3dbb258ccd0079c92ad0e23b95b2c2079f70.zip\"},\"Description\":\"/opt/awscli/aws\"},\"Type\":\"AWS::Lambda::LayerVersion\"},\"cloudfrontcontrolplaneportalhtmldeployCustomResourceB065A9C8\":{\"DeletionPolicy\":\"Delete\",\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/cloudfront_control_plane/portal_html_deploy/CustomResource/Default\"},\"Properties\":{\"DestinationBucketName\":{\"Ref\":\"cloudfrontcontrolplaneportalbucket1534502E\"},\"DistributionId\":{\"Ref\":\"cloudfrontcontrolplanePortalDistributionCAE911E8\"},\"DistributionPaths\":[\"/index.html\",\"/asset-manifest.json\",\"/robots.txt\",\"/aws-exports.json\",\"/locales/*\"],\"Prune\":false,\"ServiceToken\":{\"Fn::GetAtt\":[\"CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C81C01536\",\"Arn\"]},\"SourceBucketNames\":[{\"Fn::Sub\":\"solutions-${AWS::Region}\"}],\"SourceObjectKeys\":[\"clickstream-analytics-on-aws/v1.1.11/e395b7143572bfaa93e3c828f840b8a21c4b127a5f38b7a3e8a6a6c85e6f2524.zip\"],\"SystemMetadata\":{\"cache-control\":\"max-age=0\"}},\"Type\":\"Custom::CDKBucketDeployment\",\"UpdateReplacePolicy\":\"Delete\"},\"responseheaderspolicy35100ADE\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/response_headers_policy/Resource\"},\"Properties\":{\"ResponseHeadersPolicyConfig\":{\"Name\":{\"Fn::Join\":[\"\",[\"clickstream-response_header-policy-\",{\"Ref\":\"AWS::Region\"},\"-\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]}]]},\"SecurityHeadersConfig\":{\"ContentSecurityPolicy\":{\"ContentSecurityPolicy\":{\"Fn::Join\":[\"\",[\"default-src 'self' data:; upgrade-insecure-requests; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self'; connect-src 'self' https://cognito-idp.\",{\"Ref\":\"AWS::Region\"},\".amazonaws.com *.auth.\",{\"Ref\":\"AWS::Region\"},\".amazoncognito.com \",{\"Fn::GetAtt\":[\"ClickstreamSolutionDataBucket200465FE\",\"DomainName\"]},\" \",{\"Fn::GetAtt\":[\"ClickstreamSolutionDataBucket200465FE\",\"RegionalDomainName\"]},\"; frame-src *.quicksight.\",{\"Ref\":\"AWS::Partition\"},\".amazon.com cn-north-1.quicksight.amazonaws.cn cn-northwest-1.quicksight.amazonaws.cn;\"]]},\"Override\":true},\"ContentTypeOptions\":{\"Override\":true},\"FrameOptions\":{\"FrameOption\":\"DENY\",\"Override\":true},\"ReferrerPolicy\":{\"Override\":true,\"ReferrerPolicy\":\"no-referrer\"},\"StrictTransportSecurity\":{\"AccessControlMaxAgeSec\":600,\"IncludeSubdomains\":true,\"Override\":true},\"XSSProtection\":{\"ModeBlock\":true,\"Override\":true,\"Protection\":true}}}},\"Type\":\"AWS::CloudFront::ResponseHeadersPolicy\"},\"userPoolDC9497E0\":{\"DeletionPolicy\":\"Delete\",\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/userPool/Resource\"},\"Properties\":{\"AccountRecoverySetting\":{\"RecoveryMechanisms\":[{\"Name\":\"verified_phone_number\",\"Priority\":1},{\"Name\":\"verified_email\",\"Priority\":2}]},\"AdminCreateUserConfig\":{\"AllowAdminCreateUserOnly\":true,\"InviteMessageTemplate\":{\"EmailMessage\":\"Hello {username}, your temporary password for ClickStream Analytics on AWS Solution is {####}\",\"EmailSubject\":\"Welcome to use Clickstream Analytics on AWS solution\"}},\"AutoVerifiedAttributes\":[\"email\"],\"EmailVerificationMessage\":\"The verification code to your new account is {####}\",\"EmailVerificationSubject\":\"Verify your new account\",\"Policies\":{\"PasswordPolicy\":{\"MinimumLength\":8,\"RequireLowercase\":true,\"RequireNumbers\":true,\"RequireSymbols\":true,\"RequireUppercase\":true}},\"SmsVerificationMessage\":\"The verification code to your new account is {####}\",\"UserPoolAddOns\":{\"AdvancedSecurityMode\":\"ENFORCED\"},\"UsernameAttributes\":[\"email\"],\"UsernameConfiguration\":{\"CaseSensitive\":false},\"VerificationMessageTemplate\":{\"DefaultEmailOption\":\"CONFIRM_WITH_CODE\",\"EmailMessage\":\"The verification code to your new account is {####}\",\"EmailSubject\":\"Verify your new account\",\"SmsMessage\":\"The verification code to your new account is {####}\"}},\"Type\":\"AWS::Cognito::UserPool\",\"UpdateReplacePolicy\":\"Delete\"},\"userPoolcognitodomain5F5914A6\":{\"Metadata\":{\"aws:cdk:path\":\"cloudfront-s3-control-plane-stack-global/userPool/cognito-domain/Resource\"},\"Properties\":{\"Domain\":{\"Fn::Join\":[\"\",[\"clickstream\",{\"Fn::Select\":[0,{\"Fn::Split\":[\"-\",{\"Fn::Select\":[2,{\"Fn::Split\":[\"/\",{\"Ref\":\"AWS::StackId\"}]}]}]}]}]]},\"UserPoolId\":{\"Ref\":\"userPoolDC9497E0\"}},\"Type\":\"AWS::Cognito::UserPoolDomain\"}},\"Rules\":{\"CognitoUnsupportedRegionRule\":{\"Assertions\":[{\"Assert\":{\"Fn::Or\":[{\"Fn::Or\":[{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"us-east-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"us-east-2\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"us-west-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"us-west-2\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"ca-central-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"sa-east-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"eu-west-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"eu-west-2\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"eu-west-3\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"eu-central-1\"]}]},{\"Fn::Or\":[{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"ap-northeast-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"ap-northeast-2\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"ap-southeast-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"ap-southeast-2\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"ap-south-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"eu-north-1\"]},{\"Fn::Equals\":[{\"Ref\":\"AWS::Region\"},\"me-south-1\"]}]}]},\"AssertDescription\":\"Cognito is not supported in current region. Please use correct CloudFormation template and try again.\"}]}}}",
            "template_url": "https://rst-clickstream-templates-bucket-dev.s3.amazonaws.com/clickstream.template.json",
            "timeout_in_minutes": 0,
            "timeouts": null
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInVwZGF0ZSI6MTgwMDAwMDAwMDAwMH19",
          "dependencies": [
            "aws_s3_bucket.clickstream_templates",
            "aws_s3_object.clickstream_template"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_s3_bucket",
      "name": "clickstream_templates",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "acceleration_status": "",
            "acl": null,
            "arn": "arn:aws:s3:::rst-clickstream-templates-bucket-dev",
            "bucket": "rst-clickstream-templates-bucket-dev",
            "bucket_domain_name": "rst-clickstream-templates-bucket-dev.s3.amazonaws.com",
            "bucket_prefix": "",
            "bucket_regional_domain_name": "rst-clickstream-templates-bucket-dev.s3.ca-central-1.amazonaws.com",
            "cors_rule": [],
            "force_destroy": false,
            "grant": [
              {
                "id": "e546c882531d6feb893c7c860e235d352993ef383b5c6890aef950de1498ec10",
                "permissions": ["FULL_CONTROL"],
                "type": "CanonicalUser",
                "uri": ""
              }
            ],
            "hosted_zone_id": "Z1QDHH18159H29",
            "id": "rst-clickstream-templates-bucket-dev",
            "lifecycle_rule": [],
            "logging": [],
            "object_lock_configuration": [],
            "object_lock_enabled": false,
            "policy": "",
            "region": "ca-central-1",
            "replication_configuration": [],
            "request_payer": "BucketOwner",
            "server_side_encryption_configuration": [
              {
                "rule": [
                  {
                    "apply_server_side_encryption_by_default": [
                      {
                        "kms_master_key_id": "",
                        "sse_algorithm": "AES256"
                      }
                    ],
                    "bucket_key_enabled": false
                  }
                ]
              }
            ],
            "tags": {},
            "tags_all": {},
            "timeouts": null,
            "versioning": [
              {
                "enabled": false,
                "mfa_delete": false
              }
            ],
            "website": [],
            "website_domain": null,
            "website_endpoint": null
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjM2MDAwMDAwMDAwMDAsInJlYWQiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19"
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_s3_object",
      "name": "clickstream_template",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "acl": null,
            "arn": "arn:aws:s3:::rst-clickstream-templates-bucket-dev/clickstream.template.json",
            "bucket": "rst-clickstream-templates-bucket-dev",
            "bucket_key_enabled": false,
            "cache_control": "",
            "checksum_algorithm": null,
            "checksum_crc32": "",
            "checksum_crc32c": "",
            "checksum_crc64nvme": "",
            "checksum_sha1": "",
            "checksum_sha256": "",
            "content": null,
            "content_base64": null,
            "content_disposition": "",
            "content_encoding": "",
            "content_language": "",
            "content_type": "application/json",
            "etag": "f8edc4ef6d4ae8c8b4f325dfb49c3ffc",
            "force_destroy": false,
            "id": "clickstream.template.json",
            "key": "clickstream.template.json",
            "kms_key_id": null,
            "metadata": {},
            "object_lock_legal_hold_status": "",
            "object_lock_mode": "",
            "object_lock_retain_until_date": "",
            "override_provider": [],
            "server_side_encryption": "AES256",
            "source": "./clickstream.template.json",
            "source_hash": null,
            "storage_class": "STANDARD",
            "tags": {},
            "tags_all": {},
            "version_id": "",
            "website_redirect": ""
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": ["aws_s3_bucket.clickstream_templates"]
        }
      ]
    }
  ],
  "check_results": null
}
